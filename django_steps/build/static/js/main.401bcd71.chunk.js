(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{1102:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),i=a(23),r=a.n(i),l=(a(450),a(3)),o=a(4),c=a(6),u=a(5),d=a(7),m=a(1111),h=a(1110),g=(a(452),a(10)),p=a.n(g),f=p.a.createActions(["loadAllSidewalks","loadMapDetails","setDrawerOpened","addFilter","clearFilters","filterMap","updateSidewalkRatings","selectSidewalk","removeFilter"]),v=a(53),y=a.n(v),b=(a(104),a(246)),S=a.n(b),C={url:"https://js.arcgis.com/4.9"},k=-113.499,w=53.5405,E={type:"unique-value",field:"AvgOverall",defaultSymbol:{type:"simple-fill"},uniqueValueInfos:[{value:5,symbol:{type:"simple-line",width:4,color:"#00A300",style:"solid"}},{value:4,symbol:{type:"simple-line",width:4,color:"#00A392",style:"solid"}},{value:3,symbol:{type:"simple-line",width:4,color:"#FF7A00",style:"solid"}},{value:2,symbol:{type:"simple-line",width:4,color:"#f9a602",style:"solid"}},{value:1,symbol:{type:"simple-line",width:4,color:"#FF0000",style:"solid"}},{value:0,symbol:{type:"simple-line",width:4,color:"#D2D3D1",style:"solid"}},{value:"",symbol:{type:"simple-line",color:"#D2D3D1",width:4,style:"solid"}}],highlightOptions:{color:[255,241,58],fillOpacity:.4}},O=a(247),I=a.n(O),j=3145728,_=function(e){return"".concat("https://199.116.235.159:8443","/api/").concat(e,"/")},D=function(){function e(){Object(l.a)(this,e)}return Object(o.a)(e,null,[{key:"sendPostRequest",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=Object.assign({uri:_(e),headers:{"Content-Type":"application/json"},json:!0,method:"POST",body:t},a);return I.a.post(n)}},{key:"sendGetRequest",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=Object.assign({uri:_(e),json:!0,qs:t},a);return I.a.get(n)}}]),e}(),N=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this))).state={sidewalks:[],sidewalkSelected:!1,longitude:k,latitude:w,mapFilters:[],searchVisible:!1},e.listenables=f,e}return Object(d.a)(t,e),Object(o.a)(t,[{key:"viewSidewalkDetails",value:function(e,t,a){this.state.view?(this.state.view.goTo({center:[a,t],animate:!0,duration:200,easing:"easy-in"}),this.setState({longitude:a,latitude:t,sidewalkSelected:!0,selectedSidewalkDetails:e})):console.error("The view was not loaded")}},{key:"onLoadAllSidewalks",value:function(){var e=this;D.sendGetRequest("sidewalk").then(function(t){e.setState({sidewalks:t})}).catch(function(e){console.error(e)})}},{key:"onSetDrawerOpened",value:function(e){this.setState({sidewalkSelected:e})}},{key:"onLoadMapDetails",value:function(){var e=this;S.a.loadModules(["esri/Map","esri/views/MapView","esri/widgets/Search","esri/widgets/BasemapToggle"],C).then(function(t){var a=t[0],n=t[1],s=t[2],i=t[3],r=new a({basemap:"dark-gray-vector"}),l=new n({map:r,container:"mapContainer",center:[e.state.longitude,e.state.latitude],zoom:15}),o=new i({view:l,nextBasemap:"osm"});l.ui.add(o,"");var c=new s({view:l});return l.ui.add(c,"top-right"),e.setState({map:r,view:l,search:c}),S.a.loadModules(["esri/layers/FeatureLayer","esri/geometry/Circle","esri/widgets/Legend","esri/widgets/Expand"],C)}).then(function(t){var a=t[0],n=t[1],s=t[2],i=t[3],r=e.state.view,l=new a({url:"https://services9.arcgis.com/8ccGcFm2KpUhl0DB/arcgis/rest/services/edm_network_walkability/FeatureServer",renderer:E,definitionExpression:""});e.setState({sidewalkColorMapRenderer:E,featureLayer:l}),window.featureLayer=l,r.when(function(){var e=new s({view:r,layerInfos:[{layer:l,title:"Sidewalk Ratings"}]}),t=new i({view:r,content:new s({view:r,layerInfos:[{layer:l,title:"Sidewalk Ratings"}]})});function a(a){!function(a){var n=a?t:e,s=a?e:t;r.ui.remove(s),r.ui.add(n,"bottom-left"),r.ui.add("filterGUIMinimized","bottom-left"),r.ui.add("filterGUI","bottom-left")}(a)}a("xsmall"===r.widthBreakpoint),r.watch("widthBreakpoint",function(e){switch(e){case"xsmall":case"small":a(!0);break;case"medium":case"large":case"xlarge":a(!1)}})});e.state.map.add(l),e.state.view.on("click",function(t){var a="",s=r.extent.width/r.width;l.popupEnabled=!1,r.popup.dockEnabled=!0,r.popup.visible=!1,r.popup.dockOptions={buttonEnabled:!1},l.popupTemplate={title:"Street ID: {osm_id}",content:"Average Rating: {AvgOverall}"};var i=new n({center:t.mapPoint,radius:5*s});e.state.search.clear(),e.state.search.activeSource&&e.state.search.activeSource.locator.locationToAddress(t.mapPoint).then(function(e){a=e.address.split(",")[0]},function(e){console.error("Error reverse GPS to address")});var o=l.createQuery();o.geometry=i,l.queryFeatures(o).then(function(n){if(0!==n.features.length){var s=parseInt(n.features[0].attributes.osm_id),i=e.state.sidewalks.find(function(e){return e.id===s});if(i.address=a,!i)return void console.error("No sidewalk with a matching ID was found");e.viewSidewalkDetails(i,t.mapPoint.latitude,t.mapPoint.longitude)}})})})}},{key:"onAddFilter",value:function(e,t,a,n){var s=this.state.mapFilters;s.push({trait:e,operator:t,value:a,dbTrait:n}),this.setState({mapFilters:s})}},{key:"onRemoveFilter",value:function(e){var t=this.state.mapFilters;t.splice(e,1),this.setState({mapFilters:t}),this.onFilterMap()}},{key:"onClearFilters",value:function(){this.state.featureLayer.definitionExpression="",this.setState({mapFilters:[]})}},{key:"onFilterMap",value:function(){this.state.featureLayer.definitionExpression=this.state.mapFilters.map(function(e){return"".concat(e.dbTrait," ").concat(e.operator," ").concat(e.value)}).join(" and ")}},{key:"onUpdateSidewalkRatings",value:function(e){var t=this,a=this.state.sidewalks.slice(),n=a.find(function(e){return e.id===t.state.selectedSidewalkDetails.id});n&&(n.accessibility=e.accessibility,n.overallRating=e.overallRating,n.comfort=e.comfort,n.connectivity=e.connectivity,n.physicalSafety=e.physicalSafety,n.senseOfSecurity=e.senseOfSecurity,this.setState({sidewalks:a}))}},{key:"onSelectSidewalk",value:function(e){var t=this;if(this.state.featureLayer){var a=this.state.featureLayer.createQuery();this.state.featureLayer.queryFeatures(a).then(function(a){var n=a.features.find(function(t){return parseInt(t.attributes.osm_id)===e.id});n?t.viewSidewalkDetails(e,n.geometry.extent.center.latitude,n.geometry.extent.center.longitude):t.viewSidewalkDetails(e,t.state.latitude,t.state.longitude)})}else this.viewSidewalkDetails(e,this.state.latitude,this.state.longitude)}}]),t}(p.a.Store),R=a(1112),x=a(1103),T=a(1108),F=a(1113),M=["Overall","Accessibility","Comfort","Connectivity","Physical Safety","Sense of Security"],P=[">","<",">=","<=","="],L=[1,2,3,4,5],A={Overall:"AvgOverall","Sense of Security":"AvgSecurity",Accessibility:"AvgAccessibility",Connectivity:"AvgConnectivity",Comfort:"AvgComfort","Physical Safety":"AvgSafety"},B=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this))).handleAddFilterEvent=function(){f.addFilter(e.state.selectedTrait,e.state.selectedOperator,e.state.selectedValue,A[e.state.selectedTrait])},e.handleClearFilterEvent=function(){f.clearFilters()},e._handleTraitChange=function(t){e.setState({selectedTrait:t.target.value})},e._handleOperatorChange=function(t){e.setState({selectedOperator:t.target.value})},e._handleValueChange=function(t){e.setState({selectedValue:t.target.value})},e._expand=function(){e.setState({isExpanded:!0})},e._minimize=function(){e.setState({isExpanded:!1})},e._getModalStyle=function(){return e.state.isExpanded?void 0:{opacity:0}},e._getMinimizedModalStyle=function(){return e.state.isExpanded?{opacity:0}:void 0},e.store=N,e.state={selectedTrait:M[0],selectedOperator:P[0],selectedValue:L[0],isExpanded:!1},e}return Object(d.a)(t,e),Object(o.a)(t,[{key:"renderTable",value:function(){return s.a.createElement("table",{className:"table table-bordered table-responsive-md table-striped text-center filterTable"},s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",null,"Trait"),s.a.createElement("th",null,"Operator"),s.a.createElement("th",null,"Value"),s.a.createElement("th",null))),s.a.createElement("tbody",null,this.state.mapFilters.map(function(e,t){return s.a.createElement("tr",{key:t},s.a.createElement("th",null,e.trait),s.a.createElement("th",null,e.operator),s.a.createElement("th",null,e.value),s.a.createElement("th",null,s.a.createElement(y.a,{className:"closeButton",onClick:function(){return f.removeFilter(t)}})))})))}},{key:"renderSelect",value:function(e,t,a,n){return s.a.createElement("div",{className:"filterSelectGroup"},s.a.createElement(R.a,{controlId:"select".concat(e)},s.a.createElement(x.a,null,e),s.a.createElement(T.a,{componentClass:"select",placeholder:"select",onChange:n},t.map(function(e){return s.a.createElement("option",{value:e},e)}))))}},{key:"renderModalContent",value:function(){return this.state.isExpanded?s.a.createElement("div",null,s.a.createElement("div",{className:"filtersHeader"},s.a.createElement("h4",{className:"filterTitle"},"Filters"),s.a.createElement(y.a,{className:"closeFilters floatRight",onClick:this._minimize})),s.a.createElement("div",{className:"filterWrapper"},this.renderSelect("Trait",M,this.state.selectedTrait,this._handleTraitChange),this.renderSelect("Operator",P,this.state.selectedOperator,this._handleOperatorChange),this.renderSelect("Value",L,this.state.selectedValue,this._handleValueChange),s.a.createElement(F.a,{className:"addFilter",bsStyle:"primary",bsSize:"sm",onClick:this.handleAddFilterEvent},"Add")),this.renderTable(),s.a.createElement("div",{className:"btn-group floatRight"},s.a.createElement(F.a,{bsStyle:"danger",bsSize:"sm",onClick:this.handleClearFilterEvent,disabled:0===this.state.mapFilters.length},"Clear"),s.a.createElement(F.a,{className:"applyButton",bsStyle:"primary",bsSize:"sm",onClick:f.filterMap,disabled:0===this.state.mapFilters.length},"Apply Filter"))):null}},{key:"render",value:function(){return s.a.createElement("div",{className:"FilterGUIWrapper"},s.a.createElement("div",{id:"filterGUI",style:this._getModalStyle()},this.renderModalContent()),s.a.createElement("div",{id:"filterGUIMinimized",style:this._getMinimizedModalStyle()},s.a.createElement(F.a,{bsStyle:"primary",onClick:this._expand},"Filters")))}}]),t}(g.Component),U=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).handleApplyFilterEvent=function(){f.filterMap()},a.handleAddFilterEvent=function(){var e=document.getElementById("filterTable"),t=document.getElementById("rateTrait"),a=document.getElementById("equalitySelector"),n=document.getElementById("numberSelector"),s=t.options[t.selectedIndex].text,i=a.options[a.selectedIndex].text,r=n.options[n.selectedIndex].text;f.pushArray(s,i,r);var l=e.rows.length,o=e.insertRow(l),c=(e.rows[0].cells.length,o.insertCell(0)),u=o.insertCell(0),d=o.insertCell(0);c.innerHTML=r,u.innerHTML=i,d.innerHTML=s},a.handleClearFilterEvent=function(){for(var e=document.getElementById("filterTable"),t=e.rows.length-1;t>0;t--)e.deleteRow(t);f.clearFilters()},a.state={},a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){f.loadMapDetails()}},{key:"render",value:function(){return s.a.createElement("div",{id:"main"},s.a.createElement("div",{id:"mapContainer"}),s.a.createElement(B,null),s.a.createElement("div",{id:"BasemapToggle"}))}}]),t}(s.a.Component),V=p.a.createActions(["uploadSidewalkImage","loadUploadedImages","loadSidewalkDetails","uploadComment","dismissImageErrorMessage","dismissImageSuccessMessage","uploadRatings","removeLoadedComment","removeLoadedImage","dismissCommentSuccessMessage","dismissCommentErrorMessage","loadComments","dismissRatingsSuccessMessage","dismissRatingsFailureMessage","getSidewalkRatings","suspendedSidewalk","rateSuspendThirty","dismissSuspendSidewalk","dismissRateSuspendThirty","downloadSidewalkCSV","suspendedSidewalkComment","dismissSuspendSidewalkComment","commentSuspendThirty","dismissCommentSuspendThirty"]),z=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this))).state=e._getDefaultSidewalkState(),e.listenables=V,e}return Object(d.a)(t,e),Object(o.a)(t,[{key:"_getDefaultSidewalkState",value:function(){return{loadedUserImages:[],hasNextImagesPage:!0,currentSidewalk:null,uploadingSidewalkImage:!1,uploadedImageError:!1,uploadingComment:!1,uploadCommentFailed:!1,uploadImageSucceeded:!1,ratingStatus:!0,sameSidewalkRatingError:!1,thirtySecondRatingError:!1,hasNextCommentsPage:!0,sidewalkHasCSVData:!1,commentOneSidewalk:!1,thirtyCommentSuspend:!1,isNextImagePageLoading:!1}}},{key:"onLoadSidewalkDetails",value:function(e){var t=this;this.setState(this._getDefaultSidewalkState()),D.sendGetRequest("sidewalk/".concat(e.id)).then(function(a){var n=Object.assign({},e,a),s=25===n.comments.length;t.setState({currentSidewalk:n,hasNextImagesPage:n.lastImage,loadedUserImages:[n.lastImage],hasNextCommentsPage:s,address:e.address})}).catch(function(e){console.error(e)})}},{key:"onUploadSidewalkImage",value:function(e){var t=this;this.setState({uploadingSidewalkImage:!0,uploadedImageError:!1,uploadImageSucceeded:!1}),D.sendPostRequest("sidewalk/".concat(this.state.currentSidewalk.id,"/image/create"),{image:e}).then(function(){t.setState({uploadingSidewalkImage:!1,uploadImageSucceeded:!0})}).catch(function(e){t.setState({uploadingSidewalkImage:!1,uploadedImageError:!0}),console.error(e)})}},{key:"onLoadUploadedImages",value:function(e,t,a){var n=this;this.setState({isNextImagePageLoading:!0}),D.sendPostRequest("sidewalk/".concat(this.state.currentSidewalk.id,"/image"),{startIndex:e,endIndex:t}).then(function(e){n.setState({hasNextImagesPage:e.hasMoreImages,loadedUserImages:n.state.loadedUserImages.slice(0).concat(e.images),isNextImagePageLoading:!1})}).catch(function(e){n.setState({isNextImagePageLoading:!1}),console.error(e)})}},{key:"onUploadComment",value:function(e){var t=this;this.setState({uploadingComment:!0,uploadCommentSucceeded:!1,uploadCommentFailed:!1}),D.sendPostRequest("sidewalk/".concat(this.state.currentSidewalk.id,"/comment/create"),{text:e}).then(function(e){var a=t.state.currentSidewalk.comments.slice();a.unshift(e),t.setState({uploadingComment:!1,uploadCommentSucceeded:!0,currentSidewalk:Object.assign(t.state.currentSidewalk,{comments:a})})}).catch(function(e){t.setState({uploadingComment:!1,uploadCommentFailed:!0}),console.error(e)})}},{key:"onSuspendedSidewalkComment",value:function(){this.setState({commentOneSidewalk:!0})}},{key:"onDismissSuspendSidewalkComment",value:function(){this.setState({commentOneSidewalk:!1})}},{key:"onCommentSuspendThirty",value:function(){this.setState({thirtyCommentSuspend:!0})}},{key:"onDismissCommentSuspendThirty",value:function(){this.setState({thirtyCommentSuspend:!1})}},{key:"onDismissCommentSuccessMessage",value:function(){this.setState({uploadCommentSucceeded:!1})}},{key:"onDismissCommentErrorMessage",value:function(){this.setState({uploadCommentFailed:!1})}},{key:"onDismissImageErrorMessage",value:function(){this.setState({uploadedImageError:!1})}},{key:"onDismissImageSuccessMessage",value:function(){this.setState({uploadImageSucceeded:!1})}},{key:"onUploadRatings",value:function(e,t,a,n,s,i){var r=this;this.setState({isUploadingRatings:!0,successfullyUploadedRatings:!1,failedUploadingRatings:!1}),D.sendPostRequest("sidewalk/".concat(this.state.currentSidewalk.id,"/rate"),{accessibility:parseFloat(e),comfort:parseFloat(t),connectivity:parseFloat(a),senseOfSecurity:parseFloat(s),physicalSafety:parseFloat(n)}).then(function(e){return r.setState({isUploadingRatings:!1,successfullyUploadedRatings:!0}),r.synchronizeSidewalk(),i()}).catch(function(e){r.setState({isUploadingRatings:!1,failedUploadingRatings:!0}),console.error(e)})}},{key:"onSuspendedSidewalk",value:function(){this.setState({sameSidewalkRatingError:!0})}},{key:"onDismissSuspendSidewalk",value:function(){this.setState({sameSidewalkRatingError:!1})}},{key:"onRateSuspendThirty",value:function(){this.setState({thirtySecondRatingError:!0})}},{key:"onDismissRateSuspendThirty",value:function(){this.setState({thirtySecondRatingError:!1})}},{key:"onDismissRatingsSuccessMessage",value:function(){this.setState({successfullyUploadedRatings:!1})}},{key:"onDismissRatingsFailureMessage",value:function(){this.setState({failedUploadingRatings:!1})}},{key:"onRemoveLoadedComment",value:function(e){var t=this.state.currentSidewalk.comments.slice(),a=t.indexOf(e);if(-1!==a){var n=this.state.currentSidewalk.totalComments-1;t.splice(a,1),this.setState({currentSidewalk:Object.assign(this.state.currentSidewalk,{comments:t,totalComments:n})})}}},{key:"onRemoveLoadedImage",value:function(e,t,a){var n=this.state.loadedUserImages.indexOf(e);if(-1!==n){var s=this.state.currentSidewalk.totalImages-1,i=this.state.loadedUserImages.slice(),r={totalImages:s};if(i.splice(n,1),this.state.currentSidewalk.lastImage===e&&(r.lastImage=i[0]||null),this.setState({currentSidewalk:Object.assign(this.state.currentSidewalk,r),loadedUserImages:i}),n===i.length&&n>0&&t(n),0===i.length)return a()}}},{key:"onLoadComments",value:function(e,t,a){var n=this;D.sendPostRequest("sidewalk/".concat(this.state.currentSidewalk.id,"/comment"),{startIndex:e,endIndex:t}).then(function(e){var t=n.state.currentSidewalk.comments.slice().concat(e.comments);return n.setState({hasNextCommentsPage:e.hasMoreComments,currentSidewalk:Object.assign(n.state.currentSidewalk,{comments:t})}),a()}).catch(function(e){console.error(e)})}},{key:"onGetSidewalkRatings",value:function(e){var t=this;D.sendGetRequest("sidewalk/".concat(this.state.currentSidewalk.id,"/ratings")).then(function(a){return t.setState({currentSidewalk:Object.assign(t.state.currentSidewalk,a)}),e()}).catch(function(e){console.error(e)})}},{key:"synchronizeSidewalk",value:function(){var e=this,t=window.featureLayer.createQuery();t.outFields=["*"],window.featureLayer.queryFeatures(t).then(function(t){if(0!==t.features.length){var a=!0,n=!1,s=void 0;try{for(var i,r=t.features[Symbol.iterator]();!(a=(i=r.next()).done);a=!0){var l=i.value;if(e.state.currentSidewalk.id===parseInt(l.attributes.osm_id)&&Math.round(e.state.currentSidewalk.overallRating)!==l.attributes.AvgOverall){l.attributes.AvgOverall=Math.round(e.state.currentSidewalk.overallRating),l.attributes.AvgAccessibility=e.state.currentSidewalk.accessibility,l.attributes.AvgComfort=e.state.currentSidewalk.comfort,l.attributes.AvgConnectivity=e.state.currentSidewalk.connectivity,l.attributes.AvgSecurity=e.state.currentSidewalk.senseOfSecurity,l.attributes.AvgSafety=e.state.currentSidewalk.physicalSafety;var o={updateFeatures:[l]};window.featureLayer.applyEdits(o)}}}catch(c){n=!0,s=c}finally{try{a||null==r.return||r.return()}finally{if(n)throw s}}}}).catch(function(e){console.error("Failed query part",e)})}},{key:"onDownloadSidewalkCSV",value:function(e){var t=this;D.sendGetRequest("sidewalk/completeSummary").then(function(a){var n=[];n.push(["SidewalkId","AccessibilityRating","Comfort","Connectivity","SenseOfSecurity","PhysicalSafety","OverallRating","TotalRatings","TotalComments","TotalImages"]),a.sidewalks.forEach(function(t){t.id===e&&n.push([t.id,t.accessibility,t.comfort,t.connectivity,t.senseOfSecurity,t.physicalSafety,t.overallRating,t.ratings,t.comments,t.images])}),t.setState({sidewalkCSVInfo:a,sidewalkCsvFormatted:n,sidewalkHasCSVData:!0})}).catch(function(e){console.error(e)})}}]),t}(p.a.Store),H=p.a.createActions(["deleteComment","dismissCommentSuccessMessage","dismissCommentErrorMessage","checkCredentials","logoutAdmin","deleteImage","dismissImageSuccessMessage","dismissImageErrorMessage","dismissLoginSuccess","dismissLoginError","getUnapprovedImages","handlePendingImages","dismissImageApprovalNotification","dismissImageRejectionNotification"]),W="LoginAttempts",q="Suspended",Y=1,G=3,K=function(){function e(){Object(l.a)(this,e)}return Object(o.a)(e,null,[{key:"setLocalStorage",value:function(e){void 0===localStorage[e]?localStorage[e]=1:localStorage[e]=Number(localStorage[e])+1}},{key:"setValueLocalStorage",value:function(e,t){localStorage.setItem(e,t)}},{key:"getLocalStorage",value:function(e){return localStorage[e]}},{key:"deleteLocalStorage",value:function(e){localStorage.removeItem(e)}},{key:"setCookie",value:function(e,t,a,n){var s=new Date;s.setTime(s.getTime()+60*a*1e3);var i="expires="+s.toUTCString();document.cookie=e+"="+t+";"+i+";path=/"+n}},{key:"setCookieNoExpire",value:function(e,t,a){document.cookie=e+"="+t+";path=/"+a}},{key:"deleteCookie",value:function(e){document.cookie=e+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;"}},{key:"getCookie",value:function(e){for(var t=e+"=",a=decodeURIComponent(document.cookie).split(";"),n=0;n<a.length;++n){for(var s=a[n];" "===s.charAt(0);)s=s.substring(1);if(0===s.indexOf(t))return s.substring(t.length,s.length)}return""}}]),e}(),J=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this))).state={isLoggedIn:!1,isDeletingComment:!1,successfullyDeletedComment:!1,failedDeleteComment:!1,username:"",password:"",credentialError:!1,pendingImages:[],isNextPageLoading:!1},e.listenables=H,e}return Object(d.a)(t,e),Object(o.a)(t,[{key:"onDeleteComment",value:function(e,t,a){var n=this;this.setState({isDeletingComment:!0,successfullyDeletedComment:!1,failedDeleteComment:!1}),D.sendPostRequest("sidewalk/".concat(e,"/comment/delete"),{id:t,username:this.state.username,password:this.state.password}).then(function(){return n.setState({isDeletingComment:!1,successfullyDeletedComment:!0}),a(!0)}).catch(function(e){n.setState({isDeletingComment:!1,failedDeleteComment:!0}),a(!1),console.error(e)})}},{key:"onDismissCommentSuccessMessage",value:function(){this.setState({successfullyDeletedComment:!1})}},{key:"onDismissCommentErrorMessage",value:function(){this.setState({failedDeleteComment:!1})}},{key:"onCheckCredentials",value:function(e,t){var a=this;D.sendPostRequest("adminAccount/login",{username:e,password:t}).then(function(n){a.setState({isLoggedIn:!0,successfullyLoggedIn:!0,username:e,password:t})}).catch(function(e){a.setState({isLoggedIn:!1,failedToLogIn:!0}),401===e.statusCode&&!0!==K.getCookie(q)&&K.setLocalStorage(W),console.error(e)})}},{key:"onLogoutAdmin",value:function(){this.setState({isLoggedIn:!1})}},{key:"onDeleteImage",value:function(e,t,a){var n=this;this.setState({isDeletingImage:!0,successfullyDeletedImage:!1,failedDeleteImage:!1}),D.sendPostRequest("sidewalk/".concat(e,"/image/delete"),{imageId:t,username:this.state.username,password:this.state.password}).then(function(){return n.setState({isDeletingImage:!1,successfullyDeletedImage:!0}),a(!0)}).catch(function(e){return n.setState({isDeletingImage:!1,failedDeleteImage:!0}),console.error(e),a(!1)})}},{key:"onDismissImageSuccessMessage",value:function(){this.setState({successfullyDeletedImage:!1})}},{key:"onDismissImageErrorMessage",value:function(){this.setState({failedDeleteImage:!1})}},{key:"onDismissLoginSuccess",value:function(){this.setState({successfullyLoggedIn:!1})}},{key:"onDismissLoginError",value:function(){this.setState({failedToLogIn:!1})}},{key:"onHandlePendingImages",value:function(e,t,a,n){var s=this;this.setState({respondingToImage:!0,successfullyRespondedToImage:!1,failedToRespondToImage:!1}),D.sendPostRequest("sidewalk/".concat(a,"/image/respond"),{username:this.state.username,password:this.state.password,accepted:e,imageId:t}).then(function(e){var a=s.state.pendingImages.findIndex(function(e){return e.id===t}),i=s.state.pendingImages.slice();if(i.splice(a,1),s.setState({respondingToImage:!1,successfullyRespondedToImage:!0,pendingImages:i}),a===i.length&&a>0)return n(a)}).catch(function(e){s.setState({respondingToImage:!1,failedToRespondToImage:!0}),console.error(e)})}},{key:"onGetUnapprovedImages",value:function(e,t){var a=this;this.setState({isNextPageLoading:!0}),D.sendPostRequest("sidewalk/unapprovedImages",{username:this.state.username,password:this.state.password,startIndex:e,endIndex:t}).then(function(e){var t=a.state.pendingImages.slice().concat(e.images);a.setState({hasMoreImages:e.hasMoreImages,pendingImages:t,isNextPageLoading:!1})}).catch(function(e){a.setState({isNextPageLoading:!1}),console.error(e)})}},{key:"onDismissImageApprovalNotification",value:function(){this.setState({successfullyRespondedToImage:!1})}},{key:"onDismissImageRejectionNotification",value:function(){this.setState({failedToRespondToImage:!1})}}]),t}(p.a.Store),Q=a(1104),X=a(418),$=a.n(X),Z=a(241),ee=a(107),te=a.n(ee),ae=a(242),ne=a.n(ae),se=["January","February","March","April","May","June","July","August","September","October","November","December"],ie=function(){function e(){Object(l.a)(this,e)}return Object(o.a)(e,null,[{key:"formatDateForDisplay",value:function(e){return ne()(e).format("MMMM DD, YYYY - h:mm A")}},{key:"getMonthName",value:function(e){return se[e-1]}}]),e}(),re=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this)))._handleDelete=function(){e.props.onDelete(e.props.details)},e.store=J,e.state={},e}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return s.a.createElement(te.a,{className:"commentDisplayBox"},this.state.isLoggedIn&&s.a.createElement(y.a,{onClick:this._handleDelete,className:"closeButton"}),s.a.createElement("h5",null,this.props.details.text),s.a.createElement("h6",null,ie.formatDateForDisplay(new Date(this.props.details.date))))}}]),t}(p.a.Component),le=a(419),oe=a.n(le),ce=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return s.a.createElement(oe.a,null)}}]),t}(s.a.Component),ue=a(1107),de=a(106),me=a.n(de),he=a(50),ge=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e)))._cancel=function(){a.props.onCancel()},a._confirm=function(){a.props.onConfirm()},a.state={},a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this.props.classes;return s.a.createElement(me.a,{open:this.props.visible,onClose:this._cancel},s.a.createElement("div",{className:e.paper},s.a.createElement(ue.a.Header,null,s.a.createElement(ue.a.Title,null,this.props.title)),s.a.createElement("div",{className:"marginUpDown15"},this.props.body),s.a.createElement(ue.a.Footer,null,s.a.createElement(F.a,{onClick:this._cancel},"Cancel"),s.a.createElement(F.a,{bsStyle:"primary",onClick:this._confirm,disabled:this.props.disabledConfirm},"Confirm"))))}}]),t}(s.a.Component),pe=Object(he.withStyles)(function(e){return{paper:{width:"50%",backgroundColor:e.palette.background.paper,boxShadow:e.shadows[5],padding:4*e.spacing.unit,margin:"auto",position:"relative",top:"50%",transform:"translateY(-50%)"}}})(ge),fe=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e)))._cancel=function(){a.props.onClose()},a._confirm=function(){H.deleteComment(a.props.sidewalkId,a.props.comment.id,function(e){e&&a.props.onClose(!0)})},a.store=J,a.state={},a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"renderModalBody",value:function(){return this.props.visible?s.a.createElement("div",null,s.a.createElement("p",{className:"wrapText"},this.props.comment.text),this.state.isDeletingComment&&s.a.createElement(ce,null)):null}},{key:"render",value:function(){return s.a.createElement(pe,{title:"Are you sure you want to delete this comment?",body:this.renderModalBody(),onCancel:this._cancel,onConfirm:this._confirm,visible:this.props.visible,disabledConfirm:this.state.isDeletingComment})}}]),t}(p.a.Component),ve=25,ye="error",be="This comment has profanity or personal information in it.",Se="You can not post an empty comment.",Ce=/(?:(?:\+?1\s*(?:[.-]\s*)?)?(?:\(\s*([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9])\s*\)|([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9]))\s*(?:[.-]\s*)?)?([2-9]1[02-9]|[2-9][02-9]1|[2-9][02-9]{2})\s*(?:[.-]\s*)?([0-9]{4})(?:\s*(?:#|x\.?|ext\.?|extension)\s*(\d+))?/gim,ke=/[0-9]{3}.[0-9]{3}.[0-9]{4}/,we=new $.a({replaceRegex:/^[+]?[(]?[0-9]{3}[)]?[-\s.]?[0-9]{3}[-\s.]?[0-9]{4,6}$/im,placeHolder:"*"});we.addWords("@");var Ee=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this)))._validateCommentState=function(e){var t=e.length;return e.match(Ce)?{state:ye,message:"This comment contains a phone number: ".concat(e.match(Ce)[0])}:e.match(ke)?{state:ye,message:"This comment contains a phone number: ".concat(e.match(ke)[0])}:0===t?{state:ye,message:Se}:t<=300?{state:"success",message:""}:{state:ye,message:"Comments can be no more than 300 characters."}},e._performDetailedCommentValidation=function(e){var t=!0,a=!1,n=void 0;try{for(var s,i=Z.words[Symbol.iterator]();!(t=(s=i.next()).done);t=!0){var r=s.value;if("hell"!==r&&!r.includes("as")&&e.toLowerCase().includes(r))return{state:ye,message:be}}}catch(l){a=!0,n=l}finally{try{t||null==i.return||i.return()}finally{if(a)throw n}}return we.isProfane(e)?{state:ye,message:be}:{state:"success",message:""}},e._onCommentBlur=function(){var t=e._performDetailedCommentValidation(e.state.enteredComment);t.state===ye&&e.setState({commentValidation:t})},e._handleChange=function(t){e.setState({enteredComment:t.target.value,commentValidation:e._validateCommentState(t.target.value)})},e._handleCheck=function(){K.getCookie("commentTimer")||K.deleteLocalStorage("sidewalkCommented"),K.getCookie("timer"+e.state.currentSidewalk.id)||K.deleteLocalStorage("count"+e.state.currentSidewalk.id),"true"===K.getCookie("timer"+e.state.currentSidewalk.id)&&Number(K.getLocalStorage("count"+e.state.currentSidewalk.id))+1>3?V.suspendedSidewalkComment():"true"===K.getCookie("commentTimer")&&Number(K.getLocalStorage("sidewalkCommented"))+1>3?V.commentSuspendThirty():e._handleSubmit()},e._handleSubmit=function(){var t=e._performDetailedCommentValidation(e.state.enteredComment);t.state!==ye?(V.uploadComment(e.state.enteredComment),K.setLocalStorage("sidewalkCommented"),K.setLocalStorage("count"+e.state.currentSidewalk.id),1===Number(K.getLocalStorage("sidewalkCommented"))&&K.setCookie("commentTimer","true",.5,""),1===Number(K.getLocalStorage("count"+e.state.currentSidewalk.id))&&K.setCookie("timer"+e.state.currentSidewalk.id,"true",1440,""),e.setState({enteredComment:"",commentValidation:e._validateCommentState("")})):e.setState({commentValidation:t})},e._openConfirmationModal=function(t){e.setState({modalOpened:!0,selectedComment:t})},e._closeConfirmationModal=function(t){t&&V.removeLoadedComment(e.state.selectedComment),e.setState({modalOpened:!1,selectedComment:null})},e._isRowLoaded=function(t){var a=t.index;return Boolean(e.state.currentSidewalk.comments[a])},e._loadMoreRows=function(t,a){e.setState({isLoadingComments:!0}),V.loadComments(t,a+24,function(){e.setState({isLoadingComments:!1})})},e._getCommentsOnPage=function(t){return e.state.currentSidewalk.comments.slice(t*ve,t*ve+ve)},e._visitPreviousPage=function(){e.setState({currentPage:e.state.currentPage-1})},e._visitNextPage=function(){e.state.isLoadingComments||(0===e._getCommentsOnPage(e.state.currentPage+1).length&&e._loadMoreRows(e.state.currentSidewalk.comments.length,e.state.currentSidewalk.comments.length+25),e.setState({currentPage:e.state.currentPage+1}))},e.store=z,e.state={enteredComment:"",modalOpened:!1,isLoadingComments:!1,currentPage:0,commentValidation:{state:ye,message:Se}},e}return Object(d.a)(t,e),Object(o.a)(t,[{key:"renderCurrentCommentsPage",value:function(){var e=this,t=this._getCommentsOnPage(this.state.currentPage);return 0===t.length&&this.state.hasNextCommentsPage?s.a.createElement(ce,null):t.map(function(t,a){return s.a.createElement(re,{details:t,key:a,onDelete:e._openConfirmationModal})})}},{key:"render",value:function(){return this.state.currentSidewalk?s.a.createElement("div",{className:"comments"},this.state.commentValidation.message.length>0&&s.a.createElement(Q.a,{bsStyle:"danger"},this.state.commentValidation.message),s.a.createElement("div",{className:"commentBox"},s.a.createElement(R.a,{bsSize:"small",controlId:"formBasicText",validationState:this.state.commentValidation.state},s.a.createElement(T.a,{componentClass:"textarea",value:this.state.enteredComment,placeholder:"Enter a comment",onChange:this._handleChange,onBlur:this._onCommentBlur,rows:4}),s.a.createElement(T.a.Feedback,null))),s.a.createElement(F.a,{bsStyle:"primary",onClick:this._handleCheck,disabled:this.state.uploadingComment||this.state.commentValidation.state===ye},"Submit"),this.state.uploadingComment&&s.a.createElement("div",null,"Uploading...",s.a.createElement(ce,null)),s.a.createElement("hr",null),this.state.currentPage>0&&s.a.createElement("span",{className:"icon glyphicon glyphicon-arrow-left",onClick:this._visitPreviousPage}),(this.state.hasNextCommentsPage&&!this.state.isLoadingComments||this._getCommentsOnPage(this.state.currentPage+1).length>0)&&s.a.createElement("span",{className:"nextIcon glyphicon glyphicon-arrow-right",onClick:this._visitNextPage}),s.a.createElement("div",{className:"commentDisplaySection"},this.renderCurrentCommentsPage()),s.a.createElement(fe,{comment:this.state.selectedComment,sidewalkId:this.state.currentSidewalk.id,onClose:this._closeConfirmationModal,visible:this.state.modalOpened})):null}}]),t}(p.a.Component),Oe=function(e){return new Promise(function(t,a){var n=new FileReader;n.onerror=function(e){n.abort(),a(e)},n.onload=function(){t(this.result)},n.readAsDataURL(e)})},Ie=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"rowImgSelector"},s.a.createElement(T.a,{readOnly:!0,type:"text",placeholder:this.props.fileName||"No file selected"}),s.a.createElement(F.a,{onClick:function(){return e.fileInput.click()},bsStyle:"primary"},s.a.createElement("div",null,s.a.createElement("input",{type:"file",accept:"image/*",onChange:this.props.onSelect,className:"uploadImageInput",ref:function(t){e.fileInput=t}}),s.a.createElement("span",{className:"imageComponentButtonText"},"Choose File"))))}}]),t}(s.a.Component),je=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e)))._selectImageToUpload=function(e){var t=e.target.files[0];t&&t.size<=j?(a.setState({loadingSelectedImage:!0,selectedImageSize:null,selectedImage:null,selectedFileName:t.name}),Oe(t).then(function(e){a.setState({selectedImage:e,selectedImageSize:t.size,loadingSelectedImage:!1})})):(!a.state.selectedImage||t&&t.size>j)&&a.setState({selectedImageSize:t&&t.size,selectedImage:null,selectedFileName:t&&t.name,loadingSelectedImage:!1})},a._shouldDisplaySizeWarning=function(){return Boolean(a.state.selectedImageSize&&a.state.selectedImageSize>j)},a._canUpload=function(){return Boolean(a.state.selectedImage&&a.state.selectedImageSize<=j)},a._cancel=function(){a.setState({selectedImage:null,selectedImageSize:null,selectedFileName:null,loadingSelectedImage:!1}),a.props.onClose()},a._confirmUpload=function(){a.props.onClose(a.state.selectedImage),a.setState({selectedImage:null,selectedImageSize:null,selectedFileName:null,loadingSelectedImage:!1})},a.state={},a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this.props.classes;return s.a.createElement(me.a,{open:this.props.visible,onClose:this._cancel},s.a.createElement("div",{className:e.paper},s.a.createElement(ue.a.Header,null,s.a.createElement(ue.a.Title,null,"Upload Image")),s.a.createElement("div",{className:"marginUpDown15"},this._shouldDisplaySizeWarning()&&s.a.createElement(Q.a,{bsStyle:"danger"},"That image is too large. The selected image should be no more than ",Math.floor(j/1048576)," megabytes."),s.a.createElement(Ie,{onSelect:this._selectImageToUpload,fileName:this.state.selectedFileName}),this.state.selectedImage&&s.a.createElement("div",{className:"selectedImagePreview"},s.a.createElement("img",{className:"img-responsive",alt:"selected",src:this.state.selectedImage})),this.state.loadingSelectedImage&&s.a.createElement(ce,null)),s.a.createElement(ue.a.Footer,null,s.a.createElement(F.a,{onClick:this._cancel},"Cancel"),s.a.createElement(F.a,{bsStyle:"primary",onClick:this._confirmUpload,disabled:!this._canUpload()},"Upload"))))}}]),t}(s.a.Component),_e=Object(he.withStyles)(function(e){return{paper:{width:"50%",backgroundColor:e.palette.background.paper,boxShadow:e.shadows[5],padding:4*e.spacing.unit,margin:"auto",position:"relative",top:"50%",transform:"translateY(-50%)"}}})(je),De=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return s.a.createElement(F.a,{bsStyle:"primary",onClick:this.props.onClick},s.a.createElement("span",{className:"glyphicon glyphicon-camera"}),s.a.createElement("span",{className:"uploadSidewalkImageText"},"Upload Image"))}}]),t}(s.a.Component),Ne=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return 0===this.props.imageCount?s.a.createElement("h5",null,"Nobody has uploaded images yet for this sidewalk."):s.a.createElement("div",{className:"previewSidewalkImages"},s.a.createElement(F.a,{bsStyle:"primary",onClick:this.props.onClick},"View ",this.props.imageCount," images"))}}]),t}(s.a.Component),Re=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this)))._viewImages=function(){e.props.onOpenImages()},e._openImageModal=function(){e.setState({modalOpened:!0})},e._closeImageModal=function(t){e.setState({modalOpened:!1}),t&&V.uploadSidewalkImage(t)},e.store=z,e.state={modalOpened:!1},e}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return this.state.currentSidewalk?s.a.createElement("div",null,s.a.createElement(Ne,{imageCount:this.state.currentSidewalk.totalImages,previewImage:this.state.currentSidewalk.lastImage,onClick:this._viewImages}),s.a.createElement(De,{onClick:this._openImageModal}),this.state.uploadingSidewalkImage&&s.a.createElement("div",{className:"marginTop10"},s.a.createElement("span",{className:"marginRight10"},"Uploading..."),s.a.createElement(ce,null)),s.a.createElement(_e,{visible:this.state.modalOpened,onClose:this._closeImageModal})):null}}]),t}(p.a.Component),xe=a(420),Te=a.n(xe),Fe=a(422),Me=a.n(Fe),Pe=a(140),Le=a.n(Pe),Ae=a(421),Be=a.n(Ae),Ue=a(249),Ve=a.n(Ue),ze=a(65),He=a.n(ze),We=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={},a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this.props.classes;return s.a.createElement(He.a,{className:e.root},s.a.createElement(Te.a,null,s.a.createElement(Be.a,null,s.a.createElement(Ve.a,null,s.a.createElement(Le.a,{className:e.tableCell},"Activity"),s.a.createElement(Le.a,{className:e.tableCell,numeric:!0},"Percentage"))),s.a.createElement(Me.a,null,this.props.activities.map(function(t,a){return s.a.createElement(Ve.a,{key:a},s.a.createElement(Le.a,{className:e.tableCell,component:"th",scope:"row"},t.type),s.a.createElement(Le.a,{className:e.tableCell,numeric:!0},100*t.distributionPercent))}))))}}]),t}(s.a.Component),qe=Object(he.withStyles)(function(e){return{root:{width:"100%",overflowX:"auto"},tableCell:{fontSize:"14px",fontWeight:e.typography.fontWeightRegular,fontFamily:"Proza Libre"}}})(We),Ye=a(425),Ge=a.n(Ye),Ke=a(1105),Je=a(1114),Qe=a(426),Xe=a.n(Qe),$e=a(428),Ze=a.n($e),et=a(427),tt=a.n(et),at=function(e){return e<1.5?"Poor":e<2.5?"Bad":e<3.5?"Average":e<4.5?"Great":"Excellent"},nt=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this))).changeAccessibility=function(t,a){e.setState({accessibilityValue:a})},e.ChangeConnectivity=function(t,a){e.setState({connectivityValue:a})},e.changeComfort=function(t,a){e.setState({comfortValue:a})},e.changeSafety=function(t,a){e.setState({safetyValue:a})},e.changeSecurity=function(t,a){e.setState({securityValue:a})},e._handleSubmitRating=function(){K.setLocalStorage("NumberSidewalk"),1===Number(K.getLocalStorage("NumberSidewalk"))&&K.setCookie("timer","true",.5,""),K.setCookie(e.state.currentSidewalk.id,"true",60,""),V.uploadRatings(e.state.accessibilityValue,e.state.comfortValue,e.state.connectivityValue,e.state.safetyValue,e.state.securityValue,function(){e.setState({accessibilityValue:3,connectivityValue:3,comfortValue:3,safetyValue:3,securityValue:3}),e.props.onClose(!0)})},e._submitStatus=function(){return e.state.ratingStatus},e.store=z,e.state={accessibilityValue:3,connectivityValue:3,comfortValue:3,safetyValue:3,securityValue:3},e}return Object(d.a)(t,e),Object(o.a)(t,[{key:"renderSlider",value:function(e,t,a,n,i){var r=s.a.createElement(Ke.a,{id:n},i);return s.a.createElement("div",null,s.a.createElement(Je.a,{placement:"top",overlay:r},s.a.createElement("h5",{className:"ratingsHeader"},n)),s.a.createElement("div",{className:"ratingSlider"},s.a.createElement("div",{className:e.root},s.a.createElement(Ge.a,{classes:{container:e.slider},value:t,min:1,max:5,step:1,onChange:a})),s.a.createElement("span",{style:{paddingLeft:"15px"}},at(t))))}},{key:"renderBody",value:function(){var e=this.props.classes;return s.a.createElement("div",null,this.renderSlider(e,this.state.accessibilityValue,this.changeAccessibility,"Accessibility","Accessibility refers to the availability of \n                                features and aids that make the space friendly for any user.\n                                Think about seniors, people with disabilities, children or people \n                                carrying a stroller: is this a space that they can easily use and enjoy? "),this.renderSlider(e,this.state.connectivityValue,this.ChangeConnectivity,"Connectivity","Connectivity refers to the place that this section of sidewalk has in the pedestrian \n                                    network. Do you think this sidewalk takes you to important destinations? \n                                    Is this sidewalk well integrated with public transit? Are there places to go in this sidewalk, \n                                    such as stores, a church, a school, or maybe a public space? "),this.renderSlider(e,this.state.comfortValue,this.changeComfort,"Comfort","Comfort refers to the extent to which this is an enjoyable space to walk. \n                                Think about what you can see, hear and smell: does that make you feel good? \n                                Is there enough room to move freely? Are there benches, plants, public washrooms or other elements \n                                that make walking more comfortable? "),this.renderSlider(e,this.state.safetyValue,this.changeSafety,"Physical Safety","Safety refers to being free from potential dangers that motorized traffic and any feature of the built environment can cause. \n                            Are there well-defined barriers between you and cars? Is the sidewalk pavement even and well maintained? "),this.renderSlider(e,this.state.securityValue,this.changeSecurity,"Sense of Security","Security refers to feeling protected from external threats, such as criminal or malicious acts. Can you trust \n                                the people that surround you on this sidewalk? Is this a space where you feel comfortable waiting? "))}},{key:"render",value:function(){var e=this.props.classes;return s.a.createElement(Xe.a,{open:this.props.open,onClose:this.props.onClose},s.a.createElement("div",{className:e.paper},s.a.createElement("h4",{className:"modal-title"},"Rate Sidewalk"),s.a.createElement(tt.a,null,this.state.isUploadingRatings&&s.a.createElement(ce,null),this.renderBody()),s.a.createElement(Ze.a,null,s.a.createElement(F.a,{onClick:this.props.onClose},"Cancel"),s.a.createElement(F.a,{bsStyle:"primary",type:"submit",onClick:this._handleSubmitRating,disabled:!this._submitStatus()},"Submit"))))}}]),t}(g.Component),st=Object(he.withStyles)(function(e){return{root:{width:"90%",overflowX:"hidden"},slider:{padding:"15px"},heading:{fontSize:e.typography.pxToRem(30),fontWeight:e.typography.fontWeightRegular,fontFamily:"Proza Libre"}}})(nt),it=a(178),rt=a(179),lt=a.n(rt),ot=a(429),ct=a.n(ot),ut=a(244),dt=a.n(ut),mt=a(431),ht=a.n(mt),gt=a(430),pt=a.n(gt),ft=a(432),vt=a.n(ft),yt=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).getCSVData=function(){V.downloadSidewalkCSV(a.state.currentSidewalk.id)},a._handleClose=function(){a.props.onClose()},a._handleKeyDown=function(e){"Escape"===e.key&&a._handleClose()},a._openRatingsModal=function(){K.getCookie("timer")||K.deleteLocalStorage("NumberSidewalk"),K.getCookie(a.state.currentSidewalk.id)?(a.setState({ratingsModalOpen:!1}),V.suspendedSidewalk()):"true"===K.getCookie("timer")&&Number(K.getLocalStorage("NumberSidewalk"))+1>3?(a.setState({ratingsModalOpen:!1}),V.rateSuspendThirty()):a.setState({ratingsModalOpen:!0})},a._closeRatingsModal=function(e){e&&V.getSidewalkRatings(function(){a.props.updateRatings(a.state.currentSidewalk)}),a.setState({ratingsModalOpen:!1})},a.renderRatingsAmount=function(){return 1===a.state.currentSidewalk.totalRatings?s.a.createElement("h4",null,"1 person has rated this sidewalk."):s.a.createElement("h4",null,a.state.currentSidewalk.totalRatings," people have rated this sidewalk.")},a.state={ratingsModalOpen:!1},a.stores=[z,J],a.selfRef=s.a.createRef(),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentDidUpdate",value:function(e){this.props.visible&&!e.visible&&this.props.selectedSidewalkDetails&&V.loadSidewalkDetails(this.props.selectedSidewalkDetails)}},{key:"componentDidMount",value:function(){}},{key:"renderExpansionPanel",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this.props.classes;return s.a.createElement(ct.a,{defaultExpanded:a},s.a.createElement(pt.a,{expandIcon:s.a.createElement(ht.a,null),"data-sidewalk-header":e},s.a.createElement(dt.a,{className:n.heading},e)),s.a.createElement(vt.a,null,t))}},{key:"renderSummaryDetails",value:function(){var e,t=null;return t=this.state.currentSidewalk.lastImage?s.a.createElement("div",{className:"drawerImageSection"},s.a.createElement("img",{className:"img-responsive",alt:"sidewalk-preview",src:this.state.currentSidewalk.lastImage.url})):s.a.createElement("h4",null,"There are no uploaded images for this sidewalk."),e=this.state.currentSidewalk.averageVelocity>0?"The average pedestrian velocity on this sidewalk is ".concat(this.state.currentSidewalk.averageVelocity," metres per second.;"):"No data has been recorded for the average pedestrian velocity of this sidewalk.",s.a.createElement("div",null,s.a.createElement("h3",{className:"streetNameSection"},this.state.address),s.a.createElement("hr",null),t,s.a.createElement("hr",null),s.a.createElement("h5",null,e,s.a.createElement("div",null,this.state.isLoggedIn&&this.state.sidewalkHasCSVData&&s.a.createElement(it.CSVLink,{data:this.state.sidewalkCsvFormatted},s.a.createElement(F.a,{bsStyle:"primary",className:"sidewalkCsvButton"},"Export CSV")))))}},{key:"renderUploadImageComponent",value:function(){return s.a.createElement(Re,{onOpenImages:this.props.onOpenImages})}},{key:"_formatRating",value:function(e){return e?at(e):"-"}},{key:"renderRatings",value:function(){return s.a.createElement("div",null,s.a.createElement(F.a,{bsStyle:"primary",onClick:this._openRatingsModal},"Rate this sidewalk"),s.a.createElement(st,{open:this.state.ratingsModalOpen,onClose:this._closeRatingsModal}),this.renderRatingsAmount(),s.a.createElement("hr",null),s.a.createElement("h4",null,"Overall: ",this._formatRating(this.state.currentSidewalk.overallRating)),s.a.createElement("h4",null,"Accessibility: ",this._formatRating(this.state.currentSidewalk.accessibility)),s.a.createElement("h4",null,"Connectivity: ",this._formatRating(this.state.currentSidewalk.connectivity)),s.a.createElement("h4",null,"Comfort: ",this._formatRating(this.state.currentSidewalk.comfort)),s.a.createElement("h4",null,"Physical Safety: ",this._formatRating(this.state.currentSidewalk.physicalSafety)),s.a.createElement("h4",null,"Sense of Security: ",this._formatRating(this.state.currentSidewalk.senseOfSecurity)))}},{key:"renderComments",value:function(){return s.a.createElement(Ee,null)}},{key:"renderPedestrianData",value:function(){return 0===this.state.currentSidewalk.mobilityTypeDistribution.length?s.a.createElement("h4",null,"No pedestrian data has been recorded for this sidewalk"):s.a.createElement(qe,{activities:this.state.currentSidewalk.mobilityTypeDistribution})}},{key:"renderDrawerDetails",value:function(){return this.state.currentSidewalk?(this.state.sidewalkHasCSVData||this.getCSVData(),s.a.createElement("div",{className:"sidewalkDrawer"},this.renderExpansionPanel("Summary",this.renderSummaryDetails(),!0),this.renderExpansionPanel("Images",this.renderUploadImageComponent()),this.renderExpansionPanel("Ratings",this.renderRatings()),this.renderExpansionPanel("Comments",this.renderComments()),this.renderExpansionPanel("Pedestrian Data",this.renderPedestrianData()))):null}},{key:"render",value:function(){return s.a.createElement("div",{tabIndex:0,onKeyDown:this._handleKeyDown,ref:this.selfRef,className:"noOutlineDiv"},s.a.createElement(lt.a,{open:this.props.visible,anchor:"right",variant:"temporary",ModalProps:{onBackdropClick:this._handleClose}},s.a.createElement("div",{className:"closeButton"},s.a.createElement(y.a,{onClick:this._handleClose})),this.renderDrawerDetails()))}}]),t}(g.Component),bt=Object(he.withStyles)(function(e){return{root:{width:"90%"},heading:{fontSize:e.typography.pxToRem(30),fontWeight:e.typography.fontWeightRegular,fontFamily:"Proza Libre"}}})(yt),St=a(434),Ct=a.n(St),kt=a(110),wt=a.n(kt),Et=a(58),Ot=a.n(Et),It=a(109),jt=a.n(It),_t=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e)))._cancel=function(){a.props.onClose()},a._confirm=function(){H.deleteImage(a.props.sidewalkId,a.props.image.id,function(e){e&&a.props.onClose(!0)})},a.store=J,a.state={},a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"renderModalBody",value:function(){return this.props.visible?s.a.createElement("div",null,this.state.isDeletingImage&&s.a.createElement(ce,null),s.a.createElement("div",{className:"selectedImagePreview"},s.a.createElement("img",{className:"img-responsive",alt:"selected",src:this.props.image.url}))):null}},{key:"render",value:function(){return s.a.createElement(pe,{title:"Are you sure you want to delete this image?",body:this.renderModalBody(),onCancel:this._cancel,onConfirm:this._confirm,visible:this.props.visible,disabledConfirm:this.state.isDeletingImage})}}]),t}(p.a.Component),Dt=a(433),Nt=a.n(Dt),Rt=10,xt=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).getCurrentIndex=function(){return a.galleryRef.current.getCurrentIndex()},a._onSelectionChanged=function(e){a.props.hasNextPage&&!a.props.isNextPageLoading&&a.props.loadedImages.length-e<4&&a.props.loadMoreData(a.props.loadedImages.length,a.props.loadedImages.length+Rt)},a._onImageClicked=function(e){a.galleryRef.current.slideToIndex(e)},a._handleKeyDown=function(e){a.props.visible&&"Escape"===e.key&&a.props.onClose()},a._renderCustomControls=function(){return a.props.renderAboveImage?s.a.createElement("div",{className:"imageCarouselControls"},a.props.renderAboveImage()):null},a.state={},a.galleryRef=s.a.createRef(),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"renderCarousel",value:function(){var e=this.props.loadedImages.filter(function(e){return e}).map(function(e){return{original:e.url,thumbnail:e.url,sizes:"800px",originalClass:"img-responsive"}});return s.a.createElement(Nt.a,{items:e,infinite:!1,lazyLoad:!0,showPlayButton:!1,ref:this.galleryRef,renderCustomControls:this._renderCustomControls,onSlide:this._onSelectionChanged,thumbnailPosition:"top",showFullscreenButton:!1})}},{key:"render",value:function(){return this.props.noDrawer?s.a.createElement("div",{className:"noOutlineDiv",tabIndex:0,onKeyDown:this._handleKeyDown},this.renderCarousel()):s.a.createElement("div",{className:"noOutlineDiv",tabIndex:0,onKeyDown:this._handleKeyDown},s.a.createElement(lt.a,{open:this.props.visible,variant:"persistent",onClose:this.props.onClose,anchor:"bottom",SlideProps:{unmountOnExit:!0},classes:{paper:"fullscreenDrawer"}},this.renderCarousel()))}}]),t}(s.a.Component),Tt=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e)))._loadMoreImages=function(e,t){V.loadUploadedImages(e,t)},a._onDeleteImageClicked=function(e){a.setState({modalOpened:!0,selectedImage:e})},a._onModalClosed=function(e){e&&V.removeLoadedImage(a.state.selectedImage,function(e){a.galleryRef.current._onImageClicked(e-1)},function(){a.props.onClose()}),a.setState({modalOpened:!1,selectedImage:null})},a._renderDeleteButton=function(){var e;return e=a.state.isLoggedIn?s.a.createElement(Ot.a,{item:!0},s.a.createElement(jt.a,{title:"Delete this image"},s.a.createElement(wt.a,{className:"imageDeleteAvatar",onClick:function(){a._onDeleteImageClicked(a.state.loadedUserImages[a.galleryRef.current.getCurrentIndex()])}},s.a.createElement(Ct.a,null)))):null,s.a.createElement(Ot.a,{container:!0,justify:"space-between",spacing:24,direction:"row",style:{flexGrow:1,position:"fixed"}},e,s.a.createElement(Ot.a,{item:!0},s.a.createElement(jt.a,{title:"Exit the carousel"},s.a.createElement(wt.a,{className:"imageDeleteAvatar",onClick:a.props.onClose},s.a.createElement(y.a,null)))))},a.stores=[z,J],a.state={modalOpened:!1},a.galleryRef=s.a.createRef(),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentDidUpdate",value:function(e){!e.visible&&this.props.visible&&this.state.loadedUserImages.length<2&&this.state.hasNextImagesPage&&this._loadMoreImages(this.state.loadedUserImages.length,10)}},{key:"render",value:function(){return this.state.currentSidewalk?s.a.createElement("div",null,s.a.createElement(xt,{loadedImages:this.state.loadedUserImages,hasNextPage:this.state.hasNextImagesPage,loadMoreData:this._loadMoreImages,visible:this.props.visible,isNextPageLoading:this.state.isNextImagePageLoading,onClose:this.props.onClose,renderAboveImage:this._renderDeleteButton,ref:this.galleryRef}),s.a.createElement(_t,{visible:this.props.visible&&this.state.modalOpened,onClose:this._onModalClosed,sidewalkId:this.state.currentSidewalk.id,image:this.state.selectedImage})):null}}]),t}(p.a.Component),Ft=a(436),Mt=a.n(Ft),Pt=a(435),Lt=a.n(Pt),At=a(245),Bt=a.n(At),Ut=a(175),Vt=a.n(Ut),zt=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e)))._handleClose=function(){a.props.onClose()},a.state={},a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return s.a.createElement(Lt.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:this.props.visible,autoHideDuration:4e3,onClose:this._handleClose},s.a.createElement(Bt.a,{className:this.props.alertContentClassName,"aria-describedby":"client-snackbar",message:s.a.createElement("div",{id:"client-snackbar",className:"alertBody"},this.props.icon,s.a.createElement("span",{className:"alertMessage"},this.props.message)),action:this.props.hideClose?void 0:[s.a.createElement(Vt.a,{key:"close","aria-label":"Close",color:"inherit",onClick:this._handleClose},s.a.createElement(y.a,null))]}))}}]),t}(s.a.Component),Ht=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return s.a.createElement(zt,Object.assign({},this.props,{alertContentClassName:"errorAlert",icon:s.a.createElement(Mt.a,{className:"alertIcon"})}))}}]),t}(s.a.Component),Wt=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this)))._handleClose=function(){V.dismissImageErrorMessage()},e.store=z,e}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return s.a.createElement(Ht,{onClose:this._handleClose,visible:this.state.uploadedImageError,message:"An error occurred while uploading the image."})}}]),t}(p.a.Component),qt=a(180),Yt=a.n(qt),Gt=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return s.a.createElement(zt,{onClose:this.props.onClose,visible:this.props.visible,message:this.props.message,alertContentClassName:"successAlert",icon:s.a.createElement(Yt.a,{className:"alertIcon"})})}}]),t}(s.a.Component),Kt=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this)))._handleClose=function(){V.dismissImageSuccessMessage()},e.store=z,e}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return s.a.createElement(Gt,{onClose:this._handleClose,visible:this.state.uploadImageSucceeded,message:"Your image was uploaded. It must be approved before it is visible."})}}]),t}(p.a.Component),Jt=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this)))._handleClose=function(){H.dismissCommentSuccessMessage()},e.store=J,e}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return s.a.createElement(Gt,{onClose:this._handleClose,visible:this.state.successfullyDeletedComment,message:"The comment was successfully deleted."})}}]),t}(p.a.Component),Qt=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this)))._handleClose=function(){H.dismissCommentErrorMessage()},e.store=J,e}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return s.a.createElement(Ht,{onClose:this._handleClose,visible:this.state.failedDeleteComment,message:"An error occurred while deleting the comment."})}}]),t}(p.a.Component),Xt=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this)))._handleClose=function(){H.dismissImageErrorMessage()},e.store=J,e}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return s.a.createElement(Ht,{onClose:this._handleClose,visible:this.state.failedDeleteImage,message:"An error occurred while deleting the image."})}}]),t}(p.a.Component),$t=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this)))._handleClose=function(){H.dismissImageSuccessMessage()},e.store=J,e}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return s.a.createElement(Gt,{onClose:this._handleClose,visible:this.state.successfullyDeletedImage,message:"The image has been successfully deleted."})}}]),t}(p.a.Component),Zt=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this)))._handleClose=function(){V.dismissCommentSuccessMessage()},e.store=z,e}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return s.a.createElement(Gt,{onClose:this._handleClose,visible:this.state.uploadCommentSucceeded,message:"Your comment was successfully posted."})}}]),t}(p.a.Component),ea=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this)))._handleClose=function(){V.dismissCommentErrorMessage()},e.store=z,e}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return s.a.createElement(Ht,{onClose:this._handleClose,visible:this.state.uploadCommentFailed,message:"An error occurred while posting the comment."})}}]),t}(p.a.Component),ta=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this)))._handleClose=function(){V.dismissRatingsSuccessMessage()},e.store=z,e}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return s.a.createElement(Gt,{onClose:this._handleClose,visible:this.state.successfullyUploadedRatings,message:"Your rating was successfully posted."})}}]),t}(p.a.Component),aa=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this)))._handleClose=function(){V.dismissRatingsFailureMessage()},e.store=z,e}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return s.a.createElement(Ht,{onClose:this._handleClose,visible:this.state.failedUploadingRatings,message:"An error occurred while posting the rating."})}}]),t}(p.a.Component),na=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this)))._handleClose=function(){V.dismissSuspendSidewalk()},e.store=z,e}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return s.a.createElement(Ht,{onClose:this._handleClose,visible:this.state.sameSidewalkRatingError,message:"You can only rate the same sidewalk once per hour."})}}]),t}(p.a.Component),sa=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this)))._handleClose=function(){V.dismissRateSuspendThirty()},e.store=z,e}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return s.a.createElement(Ht,{onClose:this._handleClose,visible:this.state.thirtySecondRatingError,message:"You have rated too many sidewalks within 30 seconds."})}}]),t}(p.a.Component),ia=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this)))._handleClose=function(){V.dismissSuspendSidewalkComment()},e.store=z,e}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return s.a.createElement(Ht,{onClose:this._handleClose,visible:this.state.commentOneSidewalk,message:"You can't comment on the same sidewalk more than 3 times a day."})}}]),t}(p.a.Component),ra=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this)))._handleClose=function(){V.dismissCommentSuspendThirty()},e.store=z,e}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return s.a.createElement(Ht,{onClose:this._handleClose,visible:this.state.thirtyCommentSuspend,message:"You can comment at most 3 times in 30 seconds."})}}]),t}(p.a.Component),la=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement(Wt,null),s.a.createElement(Kt,null),s.a.createElement(Jt,null),s.a.createElement(Qt,null),s.a.createElement(Xt,null),s.a.createElement($t,null),s.a.createElement(ea,null),s.a.createElement(Zt,null),s.a.createElement(ta,null),s.a.createElement(aa,null),s.a.createElement(na,null),s.a.createElement(sa,null),s.a.createElement(ia,null),s.a.createElement(ra,null))}}]),t}(s.a.Component),oa=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e)))._viewImages=function(){f.setDrawerOpened(!1),a.setState({viewingImages:!0})},a._closeImages=function(){(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&f.setDrawerOpened(!0),a.setState({viewingImages:!1})},a._updateRatings=function(e){f.updateSidewalkRatings(e)},a._onCloseDrawer=function(){a._closeImages(!1),f.setDrawerOpened(!1)},a.state={viewingImages:!1},a.store=N,a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){this.state.sidewalks&&0!==this.state.sidewalks.length||f.loadAllSidewalks()}},{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement(U,null),s.a.createElement(bt,{visible:this.state.sidewalkSelected,onClose:this._onCloseDrawer,selectedSidewalkDetails:this.state.selectedSidewalkDetails,onOpenImages:this._viewImages,updateRatings:this._updateRatings}),s.a.createElement(Tt,{onClose:this._closeImages,visible:this.state.viewingImages}),s.a.createElement(la,null))}}]),t}(g.Component),ca=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(o.a)(t,[{key:"renderCategory",value:function(e,t){return s.a.createElement("div",null,s.a.createElement("h3",null,e),s.a.createElement("p",null,t),s.a.createElement("hr",null))}},{key:"render",value:function(){return s.a.createElement("div",{className:"padding25"},this.renderCategory("About Us","Steps is a research platform by Space and Culture Research Group, aimed at developing a participatory approach to assess walkability.\n\t\t\t\t\tSteps web-app is a tool by Space and Culture and Sid Six for collecting perceptions and feedback on walkability. \n\t\t\t\t\tEdmonton residents and visitors can use this map to share their thoughts about the \n\t\t\t\t\tpedestrian network or explore the data collected to date. This information will help identify gaps in pedestrian infrastructure and build the case for improvements.\n\t\t\t\t\t"),this.renderCategory("Instructions","\n\t\t\t\t\tClick on any sidewalk to add data. You can upload pictures, make comments and rate different aspects of walkability. Your information will be stored in the segment that you selected.\n\t\t\t\t\tThe information collected by this app in entirely anonymous. Pictures and comments will be subject to admin approval.\n\t\t\t\t"))}}]),t}(s.a.Component),ua=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e)))._loadMoreImages=function(e,t){H.getUnapprovedImages(e,t)},a._onAcceptImage=function(e){a.state.respondingToImage||H.handlePendingImages(!0,e.id,e.sidewalk.id,function(e){a.galleryRef.current._onImageClicked(e-1)})},a._onRejectImage=function(e){a.state.respondingToImage||H.handlePendingImages(!1,e.id,e.sidewalk.id,function(e){a.galleryRef.current._onImageClicked(e-1)})},a._renderResponseButtons=function(){return s.a.createElement(Ot.a,{container:!0},s.a.createElement(Ot.a,{item:!0},s.a.createElement(jt.a,{title:"Reject this image"},s.a.createElement(wt.a,{className:"imageDeleteAvatar",onClick:function(){a._onRejectImage(a.state.pendingImages[a.galleryRef.current.getCurrentIndex()])}},s.a.createElement(y.a,null)))),s.a.createElement(Ot.a,{item:!0},s.a.createElement(jt.a,{title:"Approve this image"},s.a.createElement(wt.a,{className:"imageApproveAvatar",onClick:function(){a._onAcceptImage(a.state.pendingImages[a.galleryRef.current.getCurrentIndex()])}},s.a.createElement(Yt.a,null)))))},a._dismissNotifications=function(){H.dismissImageApprovalNotification(),H.dismissImageRejectionNotification()},a.store=J,a.state={},a.galleryRef=s.a.createRef(),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){0===this.state.pendingImages.length&&this._loadMoreImages(0,10)}},{key:"render",value:function(){return 0===this.state.pendingImages.length?null:s.a.createElement("div",null,s.a.createElement(xt,{loadedImages:this.state.pendingImages,hasNextPage:this.state.hasMoreImages,loadMoreData:this._loadMoreImages,visible:this.state.pendingImages.length>0,isNextPageLoading:this.state.isNextPageLoading,onClose:function(){},renderAboveImage:this._renderResponseButtons,ref:this.galleryRef,noDrawer:!0}),s.a.createElement(Gt,{onClose:this._dismissNotifications,visible:this.state.successfullyRespondedToImage,message:"Your response has been recorded."}),s.a.createElement(Ht,{onClose:this._dismissNotifications,visible:this.state.failedToRespondToImage,message:"An error occurred while recording your response."}))}}]),t}(p.a.Component),da=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).store=J,a.state={},a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){this.state.isLoggedIn||this.props.history.push("/login")}},{key:"render",value:function(){if(!this.state.isLoggedIn)return null;var e=!(0===this.state.pendingImages.length);return s.a.createElement("div",null,!e&&s.a.createElement("h3",{className:"adminPanelEmptyText"}," There are no images to approve or reject."),s.a.createElement(ua,null))}}]),t}(p.a.Component),ma=a(1106),ha=a(437),ga=a.n(ha),pa=a(438),fa=a.n(pa),va=a(90),ya=a.n(va),ba={root:{flexGrow:1},menuButton:{marginLeft:-12,marginRight:20},button:{fontSize:14,"&:hover":{color:"#FFEB3B"},"&:focus":{color:"#FFEB3B"},color:"white"},titleButton:{fontSize:18,"&:hover":{color:"#FFEB3B"},"&:focus":{color:"#FFEB3B"},color:"white",fontFamily:"Proza Libre"}},Sa=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e)))._logout=function(){H.logoutAdmin(),K.deleteCookie("User"),K.deleteLocalStorage("LoginAttempts")},a.store=J,a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this.props.classes;return s.a.createElement("div",{className:e.root},s.a.createElement(ga.a,{position:"static"},s.a.createElement(fa.a,null,s.a.createElement(ma.a,{to:"/"},s.a.createElement(ya.a,{color:"inherit",className:e.titleButton},"STEPS ")," "),s.a.createElement(ma.a,{to:"/about/"},s.a.createElement(ya.a,{color:"inherit",className:e.button},"  About ")),s.a.createElement(ma.a,{to:"/statistics/"},s.a.createElement(ya.a,{color:"inherit",className:e.button}," ",s.a.createElement(ma.a,{to:"/statistics/"})," Statistics ")),this.state.isLoggedIn&&s.a.createElement(ma.a,{to:"/dashboard"},s.a.createElement(ya.a,{color:"inherit",className:e.button},"  Dashboard")),this.state.isLoggedIn&&s.a.createElement(ya.a,{color:"inherit",onClick:this._logout,className:e.button},"Logout"))))}}]),t}(p.a.Component),Ca=Object(he.withStyles)(ba)(Sa),ka=a(439),wa=a.n(ka),Ea=a(181),Oa=a.n(Ea),Ia=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e)))._handleUserChange=function(e){a.setState({enteredName:e.target.value})},a._handlePassChange=function(e){a.setState({enteredPassword:e.target.value})},a._validateCredentials=function(){return a.state.enteredName.length>0&&a.state.enteredPassword.length>0&&!Boolean(K.getCookie(q))},a._handleSubmit=function(){var e=Number(K.getLocalStorage(W));isNaN(e)||e<G+1?H.checkCredentials(a.state.enteredName,wa()(a.state.enteredPassword)):(K.setCookie(q,"true",Y,"login"),K.deleteLocalStorage(W)),a.setState({enteredName:"",enteredPassword:""})},a._handleClose=function(){H.dismissLoginSuccess(),H.dismissLoginError()},a.store=J,a.state={enteredName:"",enteredPassword:""},a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillUpdate",value:function(){this.state.isLoggedIn&&this.props.history.push("/dashboard")}},{key:"render",value:function(){return s.a.createElement("div",{className:"LoginCSS"},s.a.createElement("div",{className:"loginContainer","data-admin-login":!0},s.a.createElement(te.a,null,s.a.createElement(Oa.a,null,s.a.createElement("h3",{className:"adminTitleLogin"},"Admin Login"),s.a.createElement(R.a,{controlId:"username",bsSize:"small"},s.a.createElement(x.a,null,"Username"),s.a.createElement(T.a,{autoFocus:!0,type:"username",value:this.state.enteredName,onChange:this._handleUserChange,placeholder:"Username"})),s.a.createElement(R.a,{controlId:"password",bsSize:"small"},s.a.createElement(x.a,null,"Password"),s.a.createElement(T.a,{value:this.state.enteredPassword,onChange:this._handlePassChange,type:"password",placeholder:"Password"})),s.a.createElement(F.a,{bsStyle:"primary",type:"submit",onClick:this._handleSubmit,disabled:!this._validateCredentials()},"Login"))),s.a.createElement(Gt,{onClose:this._handleClose,visible:this.state.successfullyLoggedIn,message:"You have successfully been logged in."}),s.a.createElement(Ht,{onClose:this._handleClose,visible:this.state.failedToLogIn,message:"You have entered an incorrect username or password."}),s.a.createElement(Ht,{onClose:function(){},visible:K.getCookie("Suspended"),hideClose:!0,message:"You have tried to log in unsuccessfully too many times. Try again in a minute."})))}}]),t}(g.Component),ja=a(251),_a=a.n(ja),Da=a(47),Na=a(440),Ra=(a(1082),p.a.createActions(["loadSummaryStatistics"])),xa=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this))).state={},e.listenables=Ra,e}return Object(d.a)(t,e),Object(o.a)(t,[{key:"onLoadSummaryStatistics",value:function(){var e=this;this.setState({isLoading:!0}),Promise.all([D.sendGetRequest("sidewalk/summary"),D.sendGetRequest("sidewalk/completeSummary")]).then(function(t){var a=t[1];(t=t[0]).isLoading=!1,t.contributionsByMonth.sort(function(e,t){var a=e.monthYear.split("/"),n=parseInt(a[0]),s=parseInt(a[1]),i=t.monthYear.split("/"),r=parseInt(i[0]),l=parseInt(i[1]);return s===l?n-r:s-l});var n=[];n.push(["SidewalkId","AccessibilityRating","Comfort","Connectivity","SenseOfSecurity","PhysicalSafety","OverallRating","TotalRatings","TotalComments","TotalImages"]),a.sidewalks.forEach(function(e){var t=[e.id,e.accessibility,e.comfort,e.connectivity,e.senseOfSecurity,e.physicalSafety,e.overallRating,e.ratings,e.comments,e.images];n.push(t)}),t.sidewalkSummary=a,t.csvFormatted=n,e.setState(t)}).catch(function(t){e.setState({isLoading:!1}),console.error(t)})}}]),t}(p.a.Store),Ta=a(442),Fa=a.n(Ta),Ma=a(252),Pa=a.n(Ma),La=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this)))._onChangeTab=function(t,a){e.setState({selectedTab:a})},e._selectTextDescription=function(){e.setState({textDescription:!0})},e._selectNumericDescription=function(){e.setState({textDescription:!1})},e.stores=[xa,J],e.state={selectedTab:0,textDescription:!0},e}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){Ra.loadSummaryStatistics()}},{key:"renderCard",value:function(e,t){return s.a.createElement(Ot.a,{item:!0,xs:!0},s.a.createElement(te.a,{className:"card"},s.a.createElement(Oa.a,null,s.a.createElement("h3",{"data-contributions-value":t},t),e)))}},{key:"renderContributionsByDate",value:function(){var e=this.state.contributionsByMonth.map(function(e){return{month:parseInt(e.monthYear.split("/")[0]),year:parseInt(e.monthYear.split("/")[1]),amount:e.contributions}});return s.a.createElement(Da.BootstrapTable,{data:e,pagination:e.length>30,keyField:"a"},s.a.createElement(Da.TableHeaderColumn,{className:"lightFontWeight",dataField:"month",dataSort:!0,dataFormat:ie.getMonthName},"Month"),s.a.createElement(Da.TableHeaderColumn,{className:"lightFontWeight",dataField:"year",dataSort:!0},"Year"),s.a.createElement(Da.TableHeaderColumn,{className:"lightFontWeight",dataField:"amount",dataSort:!0},"Contributions"))}},{key:"renderContributionsChart",value:function(){var e={labels:this.state.contributionsByMonth.map(function(e){var t=e.monthYear.split("/");return"".concat(ie.getMonthName(parseInt(t[0]))," ").concat(t[1])}),datasets:[{label:"Contributions By Month",data:this.state.contributionsByMonth.map(function(e){return e.contributions}),backgroundColor:"purple"}]};return s.a.createElement(Na.a,{data:e,options:{legend:{display:!1},scales:{yAxes:[{gridLines:{display:!1}}]}}})}},{key:"renderContributions",value:function(){return this.state.contributionsByMonth?s.a.createElement("div",{"data-summary-contributions":!0,className:"contributions"},s.a.createElement(Ot.a,{container:!0,spacing:16},this.renderCard("Total Ratings",this.state.totalRatings),this.renderCard("Total Comments",this.state.totalComments),this.renderCard("Total Images",this.state.totalImagesUploaded),this.renderCard("Contributions",this.state.totalImagesUploaded+this.state.totalRatings+this.state.totalComments)),s.a.createElement("div",{className:"table"},this.renderContributionsByDate()),this.renderContributionsChart()):s.a.createElement(ce,null)}},{key:"renderFormatSelection",value:function(){return s.a.createElement("div",null,s.a.createElement(_a.a,{checked:this.state.textDescription,onChange:this._selectTextDescription,value:"Text",name:"text-description","aria-label":"text",color:"primary"}),s.a.createElement("span",{className:"formLabel",onClick:this._selectTextDescription},"Text"),s.a.createElement(_a.a,{checked:!this.state.textDescription,onChange:this._selectNumericDescription,value:"Numeric",name:"numeric-description","aria-label":"numeric",color:"primary"}),s.a.createElement("span",{className:"formLabel",onClick:this._selectNumericDescription},"Numeric"),this.state.csvFormatted&&this.state.isLoggedIn&&s.a.createElement(it.CSVLink,{data:this.state.csvFormatted},s.a.createElement(F.a,{bsStyle:"primary",className:"csvButton"},"Export CSV")))}},{key:"renderSidewalkDetails",value:function(){var e=this;if(!this.state.sidewalkSummary)return s.a.createElement(ce,null);var t=this.state.sidewalkSummary.sidewalks,a=function(t){return e.state.textDescription?at(t):function(e){return e.toFixed(2)}(t)};return s.a.createElement("div",{className:"sidewalkDetails"},this.renderFormatSelection(),s.a.createElement(Da.BootstrapTable,{data:t,pagination:t.length>100,keyField:"id",options:{sizePerPage:100}},s.a.createElement(Da.TableHeaderColumn,{className:"lightFontWeight",dataField:"id",dataSort:!0},"ID"),s.a.createElement(Da.TableHeaderColumn,{className:"lightFontWeight",dataField:"comments",dataSort:!0},"Comments"),s.a.createElement(Da.TableHeaderColumn,{className:"lightFontWeight",dataField:"images",dataSort:!0},"Images"),s.a.createElement(Da.TableHeaderColumn,{className:"lightFontWeight",dataField:"ratings",dataSort:!0},"Ratings"),s.a.createElement(Da.TableHeaderColumn,{className:"lightFontWeight",dataField:"accessibility",dataSort:!0,dataFormat:a},"Accessibility"),s.a.createElement(Da.TableHeaderColumn,{className:"lightFontWeight",dataField:"connectivity",dataSort:!0,dataFormat:a},"Connectivity"),s.a.createElement(Da.TableHeaderColumn,{className:"lightFontWeight",dataField:"comfort",dataSort:!0,dataFormat:a},"Comfort"),s.a.createElement(Da.TableHeaderColumn,{className:"lightFontWeight",dataField:"physicalSafety",dataSort:!0,dataFormat:a},"Physical Safety"),s.a.createElement(Da.TableHeaderColumn,{className:"lightFontWeight",dataField:"senseOfSecurity",dataSort:!0,dataFormat:a},"Sense of Security"),s.a.createElement(Da.TableHeaderColumn,{className:"lightFontWeight",dataField:"overallRating",dataSort:!0,dataFormat:a},"Overall Rating")))}},{key:"renderSelectedTab",value:function(){return 0===this.state.selectedTab?this.renderContributions():this.renderSidewalkDetails()}},{key:"render",value:function(){return s.a.createElement("div",{"data-summary-stats":!0,className:"statsPanel"},s.a.createElement(He.a,null,s.a.createElement(Fa.a,{value:this.state.selectedTab,onChange:this._onChangeTab,indicatorColor:"primary",textColor:"primary",centered:!0},s.a.createElement(Pa.a,{label:"Overall Contributions"}),s.a.createElement(Pa.a,{label:"Sidewalk Details"}))),this.renderSelectedTab())}}]),t}(p.a.Component),Aa=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return s.a.createElement("div",{className:"App"},s.a.createElement(Ca,null),s.a.createElement(m.a,null,s.a.createElement(h.a,{path:"/about/",component:ca}),s.a.createElement(h.a,{path:"/statistics",component:La}),s.a.createElement(h.a,{path:"/login",component:Ia}),s.a.createElement(h.a,{path:"/map/:id",component:oa}),s.a.createElement(h.a,{path:"/dashboard",component:da}),s.a.createElement(h.a,{path:"/",component:oa})))}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Ba=a(1109),Ua=a(444),Va=a.n(Ua),za=Object(he.createMuiTheme)({palette:{primary:Va.a,secondary:{main:"#FFEB3B"}},typography:{useNextVariants:!0,fontSize:"24px"}});r.a.render(s.a.createElement(Ba.a,null,s.a.createElement(he.MuiThemeProvider,{theme:za},s.a.createElement(Aa,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},445:function(e,t,a){e.exports=a(1102)},450:function(e,t,a){},452:function(e,t,a){},489:function(e,t){},491:function(e,t){},522:function(e,t){},523:function(e,t){},571:function(e,t){},573:function(e,t){},594:function(e,t){}},[[445,2,1]]]);
//# sourceMappingURL=main.401bcd71.chunk.js.map