(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{1140:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),i=a(26),o=a.n(i),r=(a(477),a(3)),l=a(4),c=a(6),u=a(5),d=a(7),m=a(1150),h=a(1147),g=(a(479),a(10)),p=a.n(g),f=p.a.createActions(["loadAllSidewalks","loadMapDetails","setDrawerOpened","updateSidewalkRatings","selectSidewalk"]),b=(a(112),a(267)),v=a.n(b),y={url:"https://js.arcgis.com/4.9"},w=-113.499,S=53.5405,C=a(268),I=a.n(C),k=3145728,E=function(e){return"".concat("https://199.116.235.159:8443","/api/").concat(e,"/")},O=function(){function e(){Object(r.a)(this,e)}return Object(l.a)(e,null,[{key:"sendPostRequest",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=Object.assign({uri:E(e),headers:{"Content-Type":"application/json"},json:!0,method:"POST",body:t},a);return I.a.post(n)}},{key:"sendGetRequest",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=Object.assign({uri:E(e),json:!0,qs:t},a);return I.a.get(n)}}]),e}(),j=function(e){function t(){var e;return Object(r.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this))).state={sidewalks:[],sidewalkSelected:!1,longitude:w,latitude:S,searchVisible:!1},e.listenables=f,e}return Object(d.a)(t,e),Object(l.a)(t,[{key:"viewSidewalkDetails",value:function(e,t,a){this.state.view?(this.state.view.goTo({center:[a,t],animate:!0,duration:200,easing:"easy-in"}),this.setState({longitude:a,latitude:t,sidewalkSelected:!0,selectedSidewalkDetails:e})):console.error("The view was not loaded")}},{key:"onLoadAllSidewalks",value:function(){var e=this;O.sendGetRequest("sidewalk").then(function(t){e.setState({sidewalks:t})}).catch(function(e){console.error(e)})}},{key:"onSetDrawerOpened",value:function(e){this.setState({sidewalkSelected:e})}},{key:"onLoadMapDetails",value:function(){var e=this;v.a.loadModules(["esri/Map","esri/views/MapView","esri/widgets/Search","esri/widgets/BasemapToggle"],y).then(function(t){var a=t[0],n=t[1],s=t[2],i=t[3],o=new a({basemap:"dark-gray-vector"}),r=new n({map:o,container:"mapContainer",center:[e.state.longitude,e.state.latitude],zoom:15}),l=new i({view:r,nextBasemap:"osm"});r.ui.add(l,"");var c=new s({view:r});return r.ui.add(c,"top-right"),e.setState({map:o,view:r}),v.a.loadModules(["esri/layers/FeatureLayer","esri/PopupTemplate","esri/geometry/Circle","esri/Graphic","esri/core/watchUtils","esri/renderers/UniqueValueRenderer","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleLineSymbol","esri/layers/support/MapImage","esri/widgets/Legend","esri/widgets/Expand"],y)}).then(function(t){var a=t[0],n=(t[1],t[2]),s=(t[3],t[4],t[5],t[6],t[7],t[8],t[9]),i=t[10],o=e.state.view,r=new a({url:"https://services9.arcgis.com/8ccGcFm2KpUhl0DB/arcgis/rest/services/edm_network_walkability/FeatureServer",renderer:{type:"unique-value",field:"Rating",defaultSymbol:{type:"simple-fill"},uniqueValueInfos:[{value:5,symbol:{type:"simple-line",width:5,color:"#00A300",style:"solid"}},{value:4,symbol:{type:"simple-line",width:5,color:"#00A392",style:"solid"}},{value:3,symbol:{type:"simple-line",width:5,color:"#FF7A00",style:"solid"}},{value:2,symbol:{type:"simple-line",width:5,color:"#f9a602",style:"solid"}},{value:1,symbol:{type:"simple-line",width:5,color:"#FF0000",style:"solid"}},{value:"",symbol:{type:"simple-line",color:"#D2D3D1",width:5,style:"solid"}}],highlightOptions:{color:[255,241,58],fillOpacity:.4}}});e.setState({featureLayer:r}),o.when(function(){var e=new s({view:o,layerInfos:[{layer:r,title:"Sidewalk Ratings"}]}),t=new i({view:o,content:new s({view:o,layerInfos:[{layer:r,title:"Sidewalk Ratings"}]})});function a(a){!function(a){var n=a?t:e,s=a?e:t;o.ui.remove(s),o.ui.add(n,"bottom-left")}(a)}a("xsmall"===o.widthBreakpoint),o.watch("widthBreakpoint",function(e){switch(e){case"xsmall":case"small":a(!0);break;case"medium":case"large":case"xlarge":a(!1)}})});e.state.map.add(r),e.state.view.on("click",function(t){var a=o.extent.width/o.width;r.popupEnabled=!1,o.popup.dockEnabled=!0,o.popup.visible=!1,o.popup.dockOptions={buttonEnabled:!1},r.popupTemplate={title:"Street ID: {osm_id}",content:"Average Rating: {Rating}"};var s=new n({center:t.mapPoint,radius:5*a}),i=r.createQuery();i.geometry=s,r.queryFeatures(i).then(function(a){if(0!==a.features.length){var n=a.features,s=parseInt(n[0].attributes.osm_id),i=(parseInt(n[0].attributes.Rating),e.state.sidewalks.find(function(e){return e.id===s}));if(!i)return void console.error("No sidewalk with a matching ID was found");e.viewSidewalkDetails(i,t.mapPoint.latitude,t.mapPoint.longitude)}})})})}},{key:"onUpdateSidewalkRatings",value:function(e){var t=this,a=this.state.sidewalks.slice(),n=a.find(function(e){return e.id===t.state.selectedSidewalkDetails.id});n&&(n.accessibility=e.accessibility,n.overallRating=e.overallRating,n.comfort=e.comfort,n.connectivity=e.connectivity,n.physicalSafety=e.physicalSafety,n.senseOfSecurity=e.senseOfSecurity,this.setState({sidewalks:a}))}},{key:"onSelectSidewalk",value:function(e){var t=this;if(this.state.featureLayer){var a=this.state.featureLayer.createQuery();this.state.featureLayer.queryFeatures(a).then(function(a){var n=a.features.find(function(t){return parseInt(t.attributes.osm_id)===e.id});n?t.viewSidewalkDetails(e,n.geometry.extent.center.latitude,n.geometry.extent.center.longitude):t.viewSidewalkDetails(e,t.state.latitude,t.state.longitude)})}else this.viewSidewalkDetails(e,this.state.latitude,this.state.longitude)}}]),t}(p.a.Store),_=function(e){function t(){var e;return Object(r.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this))).store=j,e}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){f.loadMapDetails()}},{key:"render",value:function(){return s.a.createElement("div",{id:"mapContainer"},s.a.createElement("div",{id:"BasemapToggle"}))}}]),t}(g.Component),R=p.a.createActions(["uploadSidewalkImage","loadUploadedImages","loadSidewalkDetails","uploadComment","dismissImageErrorMessage","dismissImageSuccessMessage","uploadRatings","removeLoadedComment","removeLoadedImage","dismissCommentSuccessMessage","dismissCommentErrorMessage","loadComments","dismissRatingsSuccessMessage","dismissRatingsFailureMessage","getSidewalkRatings"]),N=function(e){function t(){var e;return Object(r.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this))).state=e._getDefaultSidewalkState(),e.listenables=R,e}return Object(d.a)(t,e),Object(l.a)(t,[{key:"_getDefaultSidewalkState",value:function(){return{loadedUserImages:[],hasNextImagesPage:!0,currentSidewalk:null,uploadingSidewalkImage:!1,uploadedImageError:!1,uploadingComment:!1,uploadCommentFailed:!1,uploadImageSucceeded:!1,hasNextCommentsPage:!0}}},{key:"onLoadSidewalkDetails",value:function(e){var t=this;this.setState(this._getDefaultSidewalkState()),O.sendGetRequest("sidewalk/".concat(e.id)).then(function(a){var n=Object.assign({},e,a),s=25===n.comments.length;t.setState({currentSidewalk:n,hasNextImagesPage:n.lastImage,loadedUserImages:[n.lastImage],hasNextCommentsPage:s})}).catch(function(e){console.error(e)})}},{key:"onUploadSidewalkImage",value:function(e){var t=this;this.setState({uploadingSidewalkImage:!0,uploadedImageError:!1,uploadImageSucceeded:!1}),O.sendPostRequest("sidewalk/".concat(this.state.currentSidewalk.id,"/image/create"),{image:e}).then(function(){t.setState({uploadingSidewalkImage:!1,uploadImageSucceeded:!0})}).catch(function(e){t.setState({uploadingSidewalkImage:!1,uploadedImageError:!0}),console.error(e)})}},{key:"onLoadUploadedImages",value:function(e,t,a){var n=this;O.sendPostRequest("sidewalk/".concat(this.state.currentSidewalk.id,"/image"),{startIndex:e,endIndex:t}).then(function(e){return n.setState({hasNextImagesPage:e.hasMoreImages,loadedUserImages:n.state.loadedUserImages.slice(0).concat(e.images)}),a()}).catch(function(e){console.error(e)})}},{key:"onUploadComment",value:function(e){var t=this;this.setState({uploadingComment:!0,uploadCommentSucceeded:!1,uploadCommentFailed:!1}),O.sendPostRequest("sidewalk/".concat(this.state.currentSidewalk.id,"/comment/create"),{text:e}).then(function(e){var a=t.state.currentSidewalk.comments.slice();a.unshift(e),t.setState({uploadingComment:!1,uploadCommentSucceeded:!0,currentSidewalk:Object.assign(t.state.currentSidewalk,{comments:a})})}).catch(function(e){t.setState({uploadingComment:!1,uploadCommentFailed:!0}),console.error(e)})}},{key:"onDismissCommentSuccessMessage",value:function(){this.setState({uploadCommentSucceeded:!1})}},{key:"onDismissCommentErrorMessage",value:function(){this.setState({uploadCommentFailed:!1})}},{key:"onDismissImageErrorMessage",value:function(){this.setState({uploadedImageError:!1})}},{key:"onDismissImageSuccessMessage",value:function(){this.setState({uploadImageSucceeded:!1})}},{key:"onUploadRatings",value:function(e,t,a,n,s,i){var o=this;this.setState({isUploadingRatings:!0,successfullyUploadedRatings:!1,failedUploadingRatings:!1}),O.sendPostRequest("sidewalk/".concat(this.state.currentSidewalk.id,"/rate"),{accessibility:parseFloat(e),comfort:parseFloat(t),connectivity:parseFloat(a),senseOfSecurity:parseFloat(s),physicalSafety:parseFloat(n)}).then(function(e){return o.setState({isUploadingRatings:!1,successfullyUploadedRatings:!0}),i()}).catch(function(e){o.setState({isUploadingRatings:!1,failedUploadingRatings:!0}),console.error(e)})}},{key:"onDismissRatingsSuccessMessage",value:function(){this.setState({successfullyUploadedRatings:!1})}},{key:"onDismissRatingsFailureMessage",value:function(){this.setState({failedUploadingRatings:!1})}},{key:"onRemoveLoadedComment",value:function(e){var t=this.state.currentSidewalk.comments.slice(),a=t.indexOf(e);if(-1!==a){var n=this.state.currentSidewalk.totalComments-1;t.splice(a,1),this.setState({currentSidewalk:Object.assign(this.state.currentSidewalk,{comments:t,totalComments:n})})}}},{key:"onRemoveLoadedImage",value:function(e,t,a){var n=this.state.loadedUserImages.indexOf(e);if(-1!==n){var s=this.state.currentSidewalk.totalImages-1,i=this.state.loadedUserImages.slice(),o={totalImages:s};if(i.splice(n,1),this.state.currentSidewalk.lastImage===e&&(o.lastImage=i[0]||null),this.setState({currentSidewalk:Object.assign(this.state.currentSidewalk,o),loadedUserImages:i}),n===i.length&&n>0&&t(n),0===i.length)return a()}}},{key:"onLoadComments",value:function(e,t,a){var n=this;O.sendPostRequest("sidewalk/".concat(this.state.currentSidewalk.id,"/comment"),{startIndex:e,endIndex:t}).then(function(e){var t=n.state.currentSidewalk.comments.slice().concat(e.comments);return n.setState({hasNextCommentsPage:e.hasMoreComments,currentSidewalk:Object.assign(n.state.currentSidewalk,{comments:t})}),a()}).catch(function(e){console.error(e)})}},{key:"onGetSidewalkRatings",value:function(e){var t=this;O.sendGetRequest("sidewalk/".concat(this.state.currentSidewalk.id,"/ratings")).then(function(a){return t.setState({currentSidewalk:Object.assign(t.state.currentSidewalk,a)}),e()}).catch(function(e){console.error(e)})}}]),t}(p.a.Store),D=a(1141),x=a(1149),P=a(1145),M=a(1148),L=a(443),T=a.n(L),U=a(262),B=a(65),F=a.n(B),A=a(54),V=a.n(A),z=["January","February","March","April","May","June","July","August","September","October","November","December"],q=function(){function e(){Object(r.a)(this,e)}return Object(l.a)(e,null,[{key:"formatDateForDisplay",value:function(e){return z[e.getMonth()]+" "+e.getDate()+", "+e.getFullYear()+" - "+function(e){return("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)}(e)}},{key:"getMonthName",value:function(e){return z[e-1]}}]),e}(),W=p.a.createActions(["deleteComment","dismissCommentSuccessMessage","dismissCommentErrorMessage","checkCredentials","deleteImage","dismissImageSuccessMessage","dismissImageErrorMessage","dismissLoginSuccess","dismissLoginError","getUnapprovedImages","handlePendingImages","dismissImageApprovalNotification","dismissImageRejectionNotification"]),Y=function(e){function t(){var e;return Object(r.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this))).state={isLoggedIn:!1,isDeletingComment:!1,successfullyDeletedComment:!1,failedDeleteComment:!1,username:"",password:"",credentialError:!1,pendingImages:[]},e.listenables=W,e}return Object(d.a)(t,e),Object(l.a)(t,[{key:"onDeleteComment",value:function(e,t,a){var n=this;this.setState({isDeletingComment:!0,successfullyDeletedComment:!1,failedDeleteComment:!1}),O.sendPostRequest("sidewalk/".concat(e,"/comment/delete"),{id:t,username:this.state.username,password:this.state.password}).then(function(){return n.setState({isDeletingComment:!1,successfullyDeletedComment:!0}),a(!0)}).catch(function(e){n.setState({isDeletingComment:!1,failedDeleteComment:!0}),a(!1),console.error(e)})}},{key:"onDismissCommentSuccessMessage",value:function(){this.setState({successfullyDeletedComment:!1})}},{key:"onDismissCommentErrorMessage",value:function(){this.setState({failedDeleteComment:!1})}},{key:"onCheckCredentials",value:function(e,t){var a=this;O.sendPostRequest("adminAccount/login",{username:e,password:t}).then(function(n){a.setState({isLoggedIn:!0,successfullyLoggedIn:!0,username:e,password:t})}).catch(function(e){a.setState({isLoggedIn:!1,failedToLogIn:!0}),console.error(e)})}},{key:"onDeleteImage",value:function(e,t,a){var n=this;this.setState({isDeletingImage:!0,successfullyDeletedImage:!1,failedDeleteImage:!1}),O.sendPostRequest("sidewalk/".concat(e,"/image/delete"),{imageId:t,username:this.state.username,password:this.state.password}).then(function(){return n.setState({isDeletingImage:!1,successfullyDeletedImage:!0}),a(!0)}).catch(function(e){return n.setState({isDeletingImage:!1,failedDeleteImage:!0}),console.error(e),a(!1)})}},{key:"onDismissImageSuccessMessage",value:function(){this.setState({successfullyDeletedImage:!1})}},{key:"onDismissImageErrorMessage",value:function(){this.setState({failedDeleteImage:!1})}},{key:"onDismissLoginSuccess",value:function(){this.setState({successfullyLoggedIn:!1})}},{key:"onDismissLoginError",value:function(){this.setState({failedToLogIn:!1})}},{key:"onHandlePendingImages",value:function(e,t){var a=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"2";this.setState({respondingToImage:!0,successfullyRespondedToImage:!1,failedToRespondToImage:!1}),O.sendPostRequest("sidewalk/".concat(n,"/image/respond"),{username:this.state.username,password:this.state.password,accepted:e,imageId:t}).then(function(e){var n=a.state.pendingImages.filter(function(e){return e.id!==t});a.setState({respondingToImage:!1,successfullyRespondedToImage:!0,pendingImages:n})}).catch(function(e){a.setState({respondingToImage:!1,failedToRespondToImage:!0}),console.error(e)})}},{key:"onGetUnapprovedImages",value:function(e,t,a){var n=this;O.sendPostRequest("sidewalk/unapprovedImages",{username:this.state.username,password:this.state.password,startIndex:e,endIndex:t}).then(function(e){var t=n.state.pendingImages.slice().concat(e.images);return n.setState({hasMoreImages:e.hasMoreImages,pendingImages:t}),a()}).catch(function(e){console.error(e)})}},{key:"onDismissImageApprovalNotification",value:function(){this.setState({successfullyRespondedToImage:!1})}},{key:"onDismissImageRejectionNotification",value:function(){this.setState({failedToRespondToImage:!1})}}]),t}(p.a.Store),G=function(e){function t(){var e;return Object(r.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this)))._handleDelete=function(){e.props.onDelete(e.props.details)},e.store=Y,e.state={},e}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return s.a.createElement(F.a,{className:"commentDisplayBox"},this.state.isLoggedIn&&s.a.createElement(V.a,{onClick:this._handleDelete,className:"closeButton"}),s.a.createElement("h5",null,this.props.details.text),s.a.createElement("h6",null,q.formatDateForDisplay(new Date(this.props.details.date))))}}]),t}(p.a.Component),H=a(445),K=a.n(H),J=function(e){function t(){return Object(r.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return s.a.createElement(K.a,null)}}]),t}(s.a.Component),Q=a(1144),X=a(113),$=a.n(X),Z=a(48),ee=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e)))._cancel=function(){a.props.onCancel()},a._confirm=function(){a.props.onConfirm()},a.state={},a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.classes;return s.a.createElement($.a,{open:this.props.visible,onClose:this._cancel},s.a.createElement("div",{className:e.paper},s.a.createElement(Q.a.Header,null,s.a.createElement(Q.a.Title,null,this.props.title)),s.a.createElement("div",{className:"marginUpDown15"},this.props.body),s.a.createElement(Q.a.Footer,null,s.a.createElement(M.a,{onClick:this._cancel},"Cancel"),s.a.createElement(M.a,{bsStyle:"primary",onClick:this._confirm,disabled:this.props.disabledConfirm},"Confirm"))))}}]),t}(s.a.Component),te=Object(Z.withStyles)(function(e){return{paper:{width:"50%",backgroundColor:e.palette.background.paper,boxShadow:e.shadows[5],padding:4*e.spacing.unit,margin:"auto",position:"relative",top:"50%",transform:"translateY(-50%)"}}})(ee),ae=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e)))._cancel=function(){a.props.onClose()},a._confirm=function(){W.deleteComment(a.props.sidewalkId,a.props.comment.id,function(e){e&&a.props.onClose(!0)})},a.store=Y,a.state={},a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"renderModalBody",value:function(){return this.props.visible?s.a.createElement("div",null,s.a.createElement("p",{className:"wrapText"},this.props.comment.text),this.state.isDeletingComment&&s.a.createElement(J,null)):null}},{key:"render",value:function(){return s.a.createElement(te,{title:"Are you sure you want to delete this comment?",body:this.renderModalBody(),onCancel:this._cancel,onConfirm:this._confirm,visible:this.props.visible,disabledConfirm:this.state.isDeletingComment})}}]),t}(p.a.Component),ne=25,se="error",ie="This comment has profanity or personal information in it.",oe="You can not post an empty comment.",re=/(?:(?:\+?1\s*(?:[.-]\s*)?)?(?:\(\s*([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9])\s*\)|([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9]))\s*(?:[.-]\s*)?)?([2-9]1[02-9]|[2-9][02-9]1|[2-9][02-9]{2})\s*(?:[.-]\s*)?([0-9]{4})(?:\s*(?:#|x\.?|ext\.?|extension)\s*(\d+))?/gim,le=/[0-9]{3}.[0-9]{3}.[0-9]{4}/,ce=new T.a({replaceRegex:/^[\+]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4,6}$/im,placeHolder:"*"});ce.addWords("@");var ue=function(e){function t(){var e;return Object(r.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this)))._validateCommentState=function(e){var t=e.length;return ce.isProfane(e)?{state:se,message:ie}:e.match(re)?{state:se,message:"This comment contains a phone number: ".concat(e.match(re)[0])}:e.match(le)?{state:se,message:"This comment contains a phone number: ".concat(e.match(le)[0])}:0===t?{state:se,message:oe}:t<=300?{state:"success",message:""}:{state:se,message:"Comments can be no more than 300 characters."}},e._validateSubstringSwears=function(e){var t=!0,a=!1,n=void 0;try{for(var s,i=U.words[Symbol.iterator]();!(t=(s=i.next()).done);t=!0){var o=s.value;if("hell"!==o&&!o.includes("as")&&e.toLowerCase().includes(o))return{state:se,message:ie}}}catch(r){a=!0,n=r}finally{try{t||null==i.return||i.return()}finally{if(a)throw n}}return{state:"success",message:""}},e._onCommentBlur=function(){var t=e._validateSubstringSwears(e.state.enteredComment);t.state===se&&e.setState({commentValidation:t})},e._handleChange=function(t){e.setState({enteredComment:t.target.value,commentValidation:e._validateCommentState(t.target.value)})},e._handleSubmit=function(){var t=e._validateSubstringSwears(e.state.enteredComment);t.state!==se?(R.uploadComment(e.state.enteredComment),e.setState({enteredComment:"",commentValidation:e._validateCommentState("")})):e.setState({commentValidation:t})},e._openConfirmationModal=function(t){e.setState({modalOpened:!0,selectedComment:t})},e._closeConfirmationModal=function(t){t&&R.removeLoadedComment(e.state.selectedComment),e.setState({modalOpened:!1,selectedComment:null})},e._isRowLoaded=function(t){var a=t.index;return Boolean(e.state.currentSidewalk.comments[a])},e._loadMoreRows=function(t,a){e.setState({isLoadingComments:!0}),R.loadComments(t,a+24,function(){e.setState({isLoadingComments:!1})})},e._getCommentsOnPage=function(t){return e.state.currentSidewalk.comments.slice(t*ne,t*ne+ne)},e._visitPreviousPage=function(){e.setState({currentPage:e.state.currentPage-1})},e._visitNextPage=function(){0===e._getCommentsOnPage(e.state.currentPage+1).length&&e._loadMoreRows(e.state.currentSidewalk.comments.length,e.state.currentSidewalk.comments.length+25),e.setState({currentPage:e.state.currentPage+1})},e.store=N,e.state={enteredComment:"",modalOpened:!1,isLoadingComments:!1,currentPage:0,commentValidation:{state:se,message:oe}},e}return Object(d.a)(t,e),Object(l.a)(t,[{key:"renderCurrentCommentsPage",value:function(){var e=this,t=this._getCommentsOnPage(this.state.currentPage);return 0===t.length&&this.state.hasNextCommentsPage?s.a.createElement(J,null):t.map(function(t,a){return s.a.createElement(G,{details:t,key:a,onDelete:e._openConfirmationModal})})}},{key:"render",value:function(){if(!this.state.currentSidewalk)return null;this.state.currentSidewalk.comments;return s.a.createElement("div",{className:"comments"},this.state.commentValidation.message.length>0&&s.a.createElement(D.a,{bsStyle:"danger"},this.state.commentValidation.message),s.a.createElement("div",{className:"commentBox"},s.a.createElement(x.a,{bsSize:"small",controlId:"formBasicText",validationState:this.state.commentValidation.state},s.a.createElement(P.a,{componentClass:"textarea",value:this.state.enteredComment,placeholder:"Enter a comment",onChange:this._handleChange,onBlur:this._onCommentBlur,rows:4}),s.a.createElement(P.a.Feedback,null))),s.a.createElement(M.a,{bsStyle:"primary",onClick:this._handleSubmit,disabled:this.state.uploadingComment||this.state.commentValidation.state===se},"Submit"),this.state.uploadingComment&&s.a.createElement("div",null,"Uploading...",s.a.createElement(J,null)),s.a.createElement("hr",null),this.state.currentPage>0&&s.a.createElement("span",{className:"icon glyphicon glyphicon-arrow-left",onClick:this._visitPreviousPage}),(this.state.hasNextCommentsPage||this._getCommentsOnPage(this.state.currentPage+1).length>0)&&s.a.createElement("span",{className:"nextIcon glyphicon glyphicon-arrow-right",onClick:this._visitNextPage}),s.a.createElement("div",{className:"commentDisplaySection"},this.renderCurrentCommentsPage()),s.a.createElement(ae,{comment:this.state.selectedComment,sidewalkId:this.state.currentSidewalk.id,onClose:this._closeConfirmationModal,visible:this.state.modalOpened}))}}]),t}(p.a.Component),de=function(e){return new Promise(function(t,a){var n=new FileReader;n.onerror=function(e){n.abort(),a(e)},n.onload=function(){t(this.result)},n.readAsDataURL(e)})},me=function(e){function t(){return Object(r.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"row"},s.a.createElement(P.a,{readOnly:!0,type:"text",placeholder:this.props.fileName||"No file selected"}),s.a.createElement(M.a,{onClick:function(){return e.fileInput.click()},bsStyle:"primary"},s.a.createElement("div",null,s.a.createElement("input",{type:"file",accept:"image/*",onChange:this.props.onSelect,className:"uploadImageInput",ref:function(t){e.fileInput=t}}),s.a.createElement("span",{className:"imageComponentButtonText"},"Choose File"))))}}]),t}(s.a.Component),he=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e)))._selectImageToUpload=function(e){var t=e.target.files[0];t&&t.size<=k?(a.setState({loadingSelectedImage:!0,selectedImageSize:null,selectedImage:null,selectedFileName:t.name}),de(t).then(function(e){a.setState({selectedImage:e,selectedImageSize:t.size,loadingSelectedImage:!1})})):(!a.state.selectedImage||t&&t.size>k)&&a.setState({selectedImageSize:t&&t.size,selectedImage:null,selectedFileName:t&&t.name,loadingSelectedImage:!1})},a._shouldDisplaySizeWarning=function(){return Boolean(a.state.selectedImageSize&&a.state.selectedImageSize>k)},a._canUpload=function(){return Boolean(a.state.selectedImage&&a.state.selectedImageSize<=k)},a._cancel=function(){a.setState({selectedImage:null,selectedImageSize:null,selectedFileName:null,loadingSelectedImage:!1}),a.props.onClose()},a._confirmUpload=function(){a.props.onClose(a.state.selectedImage),a.setState({selectedImage:null,selectedImageSize:null,selectedFileName:null,loadingSelectedImage:!1})},a.state={},a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.classes;return s.a.createElement($.a,{open:this.props.visible,onClose:this._cancel},s.a.createElement("div",{className:e.paper},s.a.createElement(Q.a.Header,null,s.a.createElement(Q.a.Title,null,"Upload Image")),s.a.createElement("div",{className:"marginUpDown15"},this._shouldDisplaySizeWarning()&&s.a.createElement(D.a,{bsStyle:"danger"},"That image is too large. The selected image should be no more than ",Math.floor(k/1048576)," megabytes."),s.a.createElement(me,{onSelect:this._selectImageToUpload,fileName:this.state.selectedFileName}),this.state.selectedImage&&s.a.createElement("div",{className:"selectedImagePreview"},s.a.createElement("img",{className:"img-responsive",alt:"selected",src:this.state.selectedImage})),this.state.loadingSelectedImage&&s.a.createElement(J,null)),s.a.createElement(Q.a.Footer,null,s.a.createElement(M.a,{onClick:this._cancel},"Cancel"),s.a.createElement(M.a,{bsStyle:"primary",onClick:this._confirmUpload,disabled:!this._canUpload()},"Upload"))))}}]),t}(s.a.Component),ge=Object(Z.withStyles)(function(e){return{paper:{width:"50%",backgroundColor:e.palette.background.paper,boxShadow:e.shadows[5],padding:4*e.spacing.unit,margin:"auto",position:"relative",top:"50%",transform:"translateY(-50%)"}}})(he),pe=function(e){function t(){return Object(r.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return s.a.createElement(M.a,{bsStyle:"primary",onClick:this.props.onClick},s.a.createElement("span",{className:"glyphicon glyphicon-camera"}),s.a.createElement("span",{className:"uploadSidewalkImageText"},"Upload Image"))}}]),t}(s.a.Component),fe=function(e){function t(){return Object(r.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return 0===this.props.imageCount?s.a.createElement("h5",null,"Nobody has uploaded images yet for this sidewalk."):s.a.createElement("div",{className:"previewSidewalkImages"},s.a.createElement(M.a,{bsStyle:"primary",onClick:this.props.onClick},"View ",this.props.imageCount," images"))}}]),t}(s.a.Component),be=function(e){function t(){var e;return Object(r.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this)))._viewImages=function(){e.props.onOpenImages()},e._openImageModal=function(){e.setState({modalOpened:!0})},e._closeImageModal=function(t){e.setState({modalOpened:!1}),t&&R.uploadSidewalkImage(t)},e.store=N,e.state={modalOpened:!1},e}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return this.state.currentSidewalk?s.a.createElement("div",null,s.a.createElement(fe,{imageCount:this.state.currentSidewalk.totalImages,previewImage:this.state.currentSidewalk.lastImage,onClick:this._viewImages}),s.a.createElement(pe,{onClick:this._openImageModal}),this.state.uploadingSidewalkImage&&s.a.createElement("div",{className:"marginTop10"},s.a.createElement("span",{className:"marginRight10"},"Uploading..."),s.a.createElement(J,null)),s.a.createElement(ge,{visible:this.state.modalOpened,onClose:this._closeImageModal})):null}}]),t}(p.a.Component),ve=a(449),ye=a.n(ve),we=a(451),Se=a.n(we),Ce=a(146),Ie=a.n(Ce),ke=a(450),Ee=a.n(ke),Oe=a(270),je=a.n(Oe),_e=a(86),Re=a.n(_e),Ne=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={},a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.classes;return s.a.createElement(Re.a,{className:e.root},s.a.createElement(ye.a,null,s.a.createElement(Ee.a,null,s.a.createElement(je.a,null,s.a.createElement(Ie.a,{className:e.tableCell},"Activity"),s.a.createElement(Ie.a,{className:e.tableCell,numeric:!0},"Percentage"))),s.a.createElement(Se.a,null,this.props.activities.map(function(t,a){return s.a.createElement(je.a,{key:a},s.a.createElement(Ie.a,{className:e.tableCell,component:"th",scope:"row"},t.type),s.a.createElement(Ie.a,{className:e.tableCell,numeric:!0},100*t.distributionPercent))}))))}}]),t}(s.a.Component),De=Object(Z.withStyles)(function(e){return{root:{width:"100%",overflowX:"auto"},tableCell:{fontSize:"14px",fontWeight:e.typography.fontWeightRegular,fontFamily:"Proza Libre"}}})(Ne),xe=a(452),Pe=a.n(xe),Me=a(453),Le=a.n(Me),Te=a(455),Ue=a.n(Te),Be=a(454),Fe=a.n(Be),Ae=function(e){return e<1.5?"Poor":e<2.5?"Bad":e<3.5?"Average":e<4.5?"Great":"Excellent"},Ve=function(e){function t(){var e;return Object(r.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this))).changeAccessibility=function(t,a){e.setState({accessibilityValue:a})},e.ChangeConnectivity=function(t,a){e.setState({connectivityValue:a})},e.changeComfort=function(t,a){e.setState({comfortValue:a})},e.changeSafety=function(t,a){e.setState({safetyValue:a})},e.changeSecurity=function(t,a){e.setState({securityValue:a})},e._handleSubmitRating=function(){R.uploadRatings(e.state.accessibilityValue,e.state.comfortValue,e.state.connectivityValue,e.state.safetyValue,e.state.securityValue,function(){e.setState({accessibilityValue:3,connectivityValue:3,comfortValue:3,safetyValue:3,securityValue:3}),e.props.onClose(!0)})},e.store=N,e.state={accessibilityValue:3,connectivityValue:3,comfortValue:3,safetyValue:3,securityValue:3},e}return Object(d.a)(t,e),Object(l.a)(t,[{key:"renderSlider",value:function(e,t,a,n){return s.a.createElement("div",null,s.a.createElement("h5",null,n),s.a.createElement("div",{className:"ratingSlider"},s.a.createElement("div",{className:e.root},s.a.createElement(Pe.a,{classes:{container:e.slider},value:t,min:1,max:5,step:1,onChange:a})),s.a.createElement("span",{style:{paddingLeft:"15px"}},Ae(t))))}},{key:"renderBody",value:function(){var e=this.props.classes;return s.a.createElement("div",null,this.renderSlider(e,this.state.accessibilityValue,this.changeAccessibility,"Accessibility"),this.renderSlider(e,this.state.connectivityValue,this.ChangeConnectivity,"Connectivity"),this.renderSlider(e,this.state.comfortValue,this.changeComfort,"Comfort"),this.renderSlider(e,this.state.safetyValue,this.changeSafety,"Physical Safety"),this.renderSlider(e,this.state.securityValue,this.changeSecurity,"Sense of Security"))}},{key:"render",value:function(){var e=this.props.classes;return s.a.createElement(Le.a,{open:this.props.open,onClose:this.props.onClose},s.a.createElement("div",{className:e.paper},s.a.createElement("h4",{className:"modal-title"},"Rate Sidewalk"),s.a.createElement(Fe.a,null,this.state.isUploadingRatings&&s.a.createElement(J,null),this.renderBody()),s.a.createElement(Ue.a,null,s.a.createElement(M.a,{onClick:this.props.onClose},"Cancel"),s.a.createElement(M.a,{bsStyle:"primary",onClick:this._handleSubmitRating,disabled:this.state.isUploadingRatings},"Submit"))))}}]),t}(g.Component),ze=Object(Z.withStyles)(function(e){return{root:{width:"90%",overflowX:"hidden"},slider:{padding:"15px"},heading:{fontSize:e.typography.pxToRem(30),fontWeight:e.typography.fontWeightRegular,fontFamily:"Proza Libre"}}})(Ve),qe=a(145),We=a.n(qe),Ye=a(456),Ge=a.n(Ye),He=a(265),Ke=a.n(He),Je=a(458),Qe=a.n(Je),Xe=a(457),$e=a.n(Xe),Ze=a(459),et=a.n(Ze),tt=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e)))._handleClose=function(){a.props.onClose()},a._handleKeyDown=function(e){"Escape"===e.key&&a._handleClose()},a._openRatingsModal=function(){a.setState({ratingsModalOpen:!0})},a._closeRatingsModal=function(e){e&&R.getSidewalkRatings(function(){a.props.updateRatings(a.state.currentSidewalk)}),a.setState({ratingsModalOpen:!1})},a.renderRatingsAmount=function(){return 1===a.state.currentSidewalk.totalRatings?s.a.createElement("h4",null,"1 person has rated this sidewalk."):s.a.createElement("h4",null,a.state.currentSidewalk.totalRatings," people have rated this sidewalk.")},a.state={ratingsModalOpen:!1},a.store=N,a.selfRef=s.a.createRef(),a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidUpdate",value:function(e){this.props.visible&&!e.visible&&this.props.selectedSidewalkDetails&&R.loadSidewalkDetails(this.props.selectedSidewalkDetails)}},{key:"renderExpansionPanel",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this.props.classes;return s.a.createElement(Ge.a,{defaultExpanded:a},s.a.createElement($e.a,{expandIcon:s.a.createElement(Qe.a,null),"data-sidewalk-header":e},s.a.createElement(Ke.a,{className:n.heading},e)),s.a.createElement(et.a,null,t))}},{key:"renderSummaryDetails",value:function(){var e=null;return e=this.state.currentSidewalk.lastImage?s.a.createElement("div",{className:"drawerImageSection"},s.a.createElement("img",{className:"img-responsive",alt:"sidewalk-preview",src:this.state.currentSidewalk.lastImage.url})):s.a.createElement("h4",null,"There are no uploaded images for this sidewalk."),s.a.createElement("div",null,s.a.createElement("h3",{className:"streetNameSection"},this.state.currentSidewalk.address),s.a.createElement("hr",null),e,s.a.createElement("hr",null),s.a.createElement("h5",null,"The average pedestrian velocity on this sidewalk is ",this.state.currentSidewalk.averageVelocity," metres per second."))}},{key:"renderUploadImageComponent",value:function(){return s.a.createElement(be,{onOpenImages:this.props.onOpenImages})}},{key:"_formatRating",value:function(e){return e?Ae(e):"-"}},{key:"renderRatings",value:function(){return s.a.createElement("div",null,s.a.createElement(M.a,{bsStyle:"primary",onClick:this._openRatingsModal},"Rate this sidewalk"),s.a.createElement(ze,{open:this.state.ratingsModalOpen,onClose:this._closeRatingsModal}),this.renderRatingsAmount(),s.a.createElement("hr",null),s.a.createElement("h4",null,"Overall: ",this._formatRating(this.state.currentSidewalk.overallRating)),s.a.createElement("h4",null,"Accessibility: ",this._formatRating(this.state.currentSidewalk.accessibility)),s.a.createElement("h4",null,"Connectivity: ",this._formatRating(this.state.currentSidewalk.connectivity)),s.a.createElement("h4",null,"Comfort: ",this._formatRating(this.state.currentSidewalk.comfort)),s.a.createElement("h4",null,"Physical Safety: ",this._formatRating(this.state.currentSidewalk.physicalSafety)),s.a.createElement("h4",null,"Sense of Security: ",this._formatRating(this.state.currentSidewalk.senseOfSecurity)))}},{key:"renderComments",value:function(){return s.a.createElement(ue,null)}},{key:"renderPedestrianData",value:function(){return 0===this.state.currentSidewalk.mobilityTypeDistribution.length?s.a.createElement("h4",null,"No pedestrian data has been recorded for this sidewalk"):s.a.createElement(De,{activities:this.state.currentSidewalk.mobilityTypeDistribution})}},{key:"renderDrawerDetails",value:function(){return this.state.currentSidewalk?s.a.createElement("div",{className:"sidewalkDrawer"},this.renderExpansionPanel("Summary",this.renderSummaryDetails(),!0),this.renderExpansionPanel("Images",this.renderUploadImageComponent()),this.renderExpansionPanel("Ratings",this.renderRatings()),this.renderExpansionPanel("Comments",this.renderComments()),this.renderExpansionPanel("Pedestrian Data",this.renderPedestrianData())):null}},{key:"render",value:function(){return s.a.createElement("div",{tabIndex:0,onKeyDown:this._handleKeyDown,ref:this.selfRef,className:"noOutlineDiv"},s.a.createElement(We.a,{open:this.props.visible,anchor:"right",variant:"temporary",ModalProps:{onBackdropClick:this._handleClose}},s.a.createElement(V.a,{onClick:this._handleClose,className:"closeButton"}),this.renderDrawerDetails()))}}]),t}(g.Component),at=Object(Z.withStyles)(function(e){return{root:{width:"90%"},heading:{fontSize:e.typography.pxToRem(30),fontWeight:e.typography.fontWeightRegular,fontFamily:"Proza Libre"}}})(tt),nt=a(460),st=a.n(nt),it=a(461),ot=a.n(it),rt=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).listRef=s.a.createRef(),a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentWillReceiveProps",value:function(){this.listRef.current.forceUpdateGrid()}},{key:"render",value:function(){var e=this,t=this.props.hasNextPage&&!this.props.isNextPageLoading?this.props.loadedItemCount+1:this.props.loadedItemCount;return s.a.createElement(st.a,{isRowLoaded:this.props.isRowLoaded,loadMoreRows:this.props.loadMoreRows,rowCount:t},function(a){var n=a.onRowsRendered;return s.a.createElement(ot.a,{ref:e.listRef,height:1e3,onRowsRendered:n,rowCount:t,rowHeight:e.props.height||200,rowRenderer:e.props.rowRenderer,width:e.props.width||250,style:{outline:"none"}})})}}]),t}(s.a.PureComponent),lt=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e)))._onImageClicked=function(e){a.setState({currentImageIndex:e}),void 0!==a.props.getImageIndex&&a.props.getImageIndex(e)},a._isRowLoaded=function(e){var t=e.index;return Boolean(a.props.loadedImages[t])},a._loadMoreRows=function(e){var t=e.startIndex,n=e.stopIndex;t||(n=(t=a.props.loadedImages.length)+1),a.props.loadMoreData(t,n+4)},a._rowRenderer=function(e){var t,n=e.index,i=e.key,o=e.style;return t=a._isRowLoaded({index:n})?s.a.createElement("div",{className:a.state.currentImageIndex===n?"infiniteImageRowSelected":"infiniteImageRowUnselected"},s.a.createElement(F.a,{className:"clickableItem"},a.props.renderAboveImage&&a.props.renderAboveImage(a.state.currentImageIndex===n,a.props.loadedImages[n]),s.a.createElement("img",{onClick:function(){a._onImageClicked(n)},className:"img-responsive fillAvailable",alt:"uploaded",src:a.props.loadedImages[n].url}))):s.a.createElement(J,null),s.a.createElement("div",{className:"infiniteImageListRow",key:i,style:o},t)},a._handleKeyDown=function(e){if(a.props.visible)if("ArrowRight"===e.key||"ArrowDown"===e.key){if(a.state.currentImageIndex===a.props.loadedImages.length-1){if(!a.props.hasNextPage)return;a._loadMoreRows({startIndex:a.state.currentImageIndex+1,stopIndex:a.state.currentImageIndex+1})}a.setState({currentImageIndex:a.state.currentImageIndex+1})}else("ArrowLeft"===e.key||"ArrowUp"===e.key)&&a.state.currentImageIndex>0?a.setState({currentImageIndex:a.state.currentImageIndex-1}):"Escape"===e.key&&a.props.onClose()},a.state={currentImageIndex:0},a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"renderSelectedImage",value:function(){var e;return e=this.props.loadedImages[this.state.currentImageIndex]?s.a.createElement("img",{className:"backgroundImage",alt:"selected",src:this.props.loadedImages[this.state.currentImageIndex].url}):s.a.createElement(J,null),s.a.createElement("div",{className:"selectedImageWrapper"},e)}},{key:"displayImageDrawer",value:function(){return s.a.createElement("div",null,s.a.createElement(We.a,{open:this.props.visible,variant:"persistent",onClose:this.props.onClose,anchor:"left",SlideProps:{unmountOnExit:!0}},this.renderSelectedImage()),s.a.createElement(We.a,{open:this.props.visible,variant:"persistent",onClose:this.props.onClose,anchor:"right",SlideProps:{unmountOnExit:!0}},s.a.createElement(V.a,{className:"closeButton",onClick:this.props.onClose}),s.a.createElement(rt,{isRowLoaded:this._isRowLoaded,loadMoreRows:this.props.isNextPageLoading?function(){}:this._loadMoreRows,rowRenderer:this._rowRenderer,hasNextPage:this.props.hasNextPage,loadedItemCount:this.props.loadedImages.length,isNextPageLoading:this.props.isNextPageLoading})))}},{key:"render",value:function(){return s.a.createElement("div",{className:"noOutlineDiv",tabIndex:0,onKeyDown:this._handleKeyDown},this.displayImageDrawer())}}]),t}(s.a.Component),ct=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e)))._cancel=function(){a.props.onClose()},a._confirm=function(){W.deleteImage(a.props.sidewalkId,a.props.image.id,function(e){e&&a.props.onClose(!0)})},a.store=Y,a.state={},a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"renderModalBody",value:function(){return this.props.visible?s.a.createElement("div",null,this.state.isDeletingImage&&s.a.createElement(J,null),s.a.createElement("div",{className:"selectedImagePreview"},s.a.createElement("img",{className:"img-responsive",alt:"selected",src:this.props.image.url}))):null}},{key:"render",value:function(){return s.a.createElement(te,{title:"Are you sure you want to delete this image?",body:this.renderModalBody(),onCancel:this._cancel,onConfirm:this._confirm,visible:this.props.visible,disabledConfirm:this.state.isDeletingImage})}}]),t}(p.a.Component),ut=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e)))._loadMoreImages=function(e,t){a.setState({isNextPageLoading:!0}),R.loadUploadedImages(e,t,function(){setTimeout(function(){a.setState({isNextPageLoading:!1})},50)})},a._onDeleteImageClicked=function(e){a.setState({modalOpened:!0,selectedImage:e})},a._onModalClosed=function(e){e&&R.removeLoadedImage(a.state.selectedImage,function(e){a.galleryRef.current._onImageClicked(e-1)},function(){a.props.onClose()}),a.setState({modalOpened:!1,selectedImage:null})},a._renderDeleteButton=function(e,t){return e&&a.state.isLoggedIn?s.a.createElement(V.a,{className:"closeButton",onClick:function(){a._onDeleteImageClicked(t)}}):null},a.stores=[N,Y],a.state={isNextPageLoading:!1,modalOpened:!1},a.galleryRef=s.a.createRef(),a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return this.state.currentSidewalk?s.a.createElement("div",null,s.a.createElement(lt,{loadedImages:this.state.loadedUserImages,hasNextPage:this.state.hasNextImagesPage,loadMoreData:this._loadMoreImages,visible:this.props.visible,isNextPageLoading:this.state.isNextPageLoading,onClose:this.props.onClose,renderAboveImage:this._renderDeleteButton,ref:this.galleryRef}),s.a.createElement(ct,{visible:this.props.visible&&this.state.modalOpened,onClose:this._onModalClosed,sidewalkId:this.state.currentSidewalk.id,image:this.state.selectedImage})):null}}]),t}(p.a.Component),dt=a(463),mt=a.n(dt),ht=a(462),gt=a.n(ht),pt=a(266),ft=a.n(pt),bt=a(264),vt=a.n(bt),yt=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e)))._handleClose=function(){a.props.onClose()},a.state={},a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return s.a.createElement(gt.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:this.props.visible,autoHideDuration:4e3,onClose:this._handleClose},s.a.createElement(ft.a,{className:this.props.alertContentClassName,"aria-describedby":"client-snackbar",message:s.a.createElement("div",{id:"client-snackbar",className:"alertBody"},this.props.icon,s.a.createElement("span",{className:"alertMessage"},this.props.message)),action:[s.a.createElement(vt.a,{key:"close","aria-label":"Close",color:"inherit",onClick:this._handleClose},s.a.createElement(V.a,null))]}))}}]),t}(s.a.Component),wt=function(e){function t(){return Object(r.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return s.a.createElement(yt,{onClose:this.props.onClose,visible:this.props.visible,message:this.props.message,alertContentClassName:"errorAlert",icon:s.a.createElement(mt.a,{className:"alertIcon"})})}}]),t}(s.a.Component),St=function(e){function t(){var e;return Object(r.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this)))._handleClose=function(){R.dismissImageErrorMessage()},e.store=N,e}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return s.a.createElement(wt,{onClose:this._handleClose,visible:this.state.uploadedImageError,message:"An error occurred while uploading the image."})}}]),t}(p.a.Component),Ct=a(183),It=a.n(Ct),kt=function(e){function t(){return Object(r.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return s.a.createElement(yt,{onClose:this.props.onClose,visible:this.props.visible,message:this.props.message,alertContentClassName:"successAlert",icon:s.a.createElement(It.a,{className:"alertIcon"})})}}]),t}(s.a.Component),Et=function(e){function t(){var e;return Object(r.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this)))._handleClose=function(){R.dismissImageSuccessMessage()},e.store=N,e}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return s.a.createElement(kt,{onClose:this._handleClose,visible:this.state.uploadImageSucceeded,message:"Your image was uploaded. It must be approved before it is visible."})}}]),t}(p.a.Component),Ot=function(e){function t(){var e;return Object(r.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this)))._handleClose=function(){W.dismissCommentSuccessMessage()},e.store=Y,e}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return s.a.createElement(kt,{onClose:this._handleClose,visible:this.state.successfullyDeletedComment,message:"The comment was successfully deleted."})}}]),t}(p.a.Component),jt=function(e){function t(){var e;return Object(r.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this)))._handleClose=function(){W.dismissCommentErrorMessage()},e.store=Y,e}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return s.a.createElement(wt,{onClose:this._handleClose,visible:this.state.failedDeleteComment,message:"An error occurred while deleting the comment."})}}]),t}(p.a.Component),_t=function(e){function t(){var e;return Object(r.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this)))._handleClose=function(){W.dismissImageErrorMessage()},e.store=Y,e}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return s.a.createElement(wt,{onClose:this._handleClose,visible:this.state.failedDeleteImage,message:"An error occurred while deleting the image."})}}]),t}(p.a.Component),Rt=function(e){function t(){var e;return Object(r.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this)))._handleClose=function(){W.dismissImageSuccessMessage()},e.store=Y,e}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return s.a.createElement(kt,{onClose:this._handleClose,visible:this.state.successfullyDeletedImage,message:"The image has been successfully deleted."})}}]),t}(p.a.Component),Nt=function(e){function t(){var e;return Object(r.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this)))._handleClose=function(){R.dismissCommentSuccessMessage()},e.store=N,e}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return s.a.createElement(kt,{onClose:this._handleClose,visible:this.state.uploadCommentSucceeded,message:"Your comment was successfully posted."})}}]),t}(p.a.Component),Dt=function(e){function t(){var e;return Object(r.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this)))._handleClose=function(){R.dismissCommentErrorMessage()},e.store=N,e}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return s.a.createElement(wt,{onClose:this._handleClose,visible:this.state.uploadCommentFailed,message:"An error occurred while posting the comment."})}}]),t}(p.a.Component),xt=function(e){function t(){var e;return Object(r.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this)))._handleClose=function(){R.dismissRatingsSuccessMessage()},e.store=N,e}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return s.a.createElement(kt,{onClose:this._handleClose,visible:this.state.successfullyUploadedRatings,message:"Your rating was successfully posted."})}}]),t}(p.a.Component),Pt=function(e){function t(){var e;return Object(r.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this)))._handleClose=function(){R.dismissRatingsFailureMessage()},e.store=N,e}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return s.a.createElement(wt,{onClose:this._handleClose,visible:this.state.failedUploadingRatings,message:"An error occurred while posting the rating."})}}]),t}(p.a.Component),Mt=function(e){function t(){return Object(r.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement(St,null),s.a.createElement(Et,null),s.a.createElement(Ot,null),s.a.createElement(jt,null),s.a.createElement(_t,null),s.a.createElement(Rt,null),s.a.createElement(Dt,null),s.a.createElement(Nt,null),s.a.createElement(xt,null),s.a.createElement(Pt,null))}}]),t}(s.a.Component),Lt=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e)))._viewImages=function(){f.setDrawerOpened(!1),a.setState({viewingImages:!0})},a._closeImages=function(){(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&f.setDrawerOpened(!0),a.setState({viewingImages:!1})},a._updateRatings=function(e){f.updateSidewalkRatings(e)},a._onCloseDrawer=function(){a._closeImages(!1),f.setDrawerOpened(!1)},a.state={viewingImages:!1},a.store=j,a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.state.sidewalks&&0!==this.state.sidewalks.length||f.loadAllSidewalks()}},{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement(_,null),s.a.createElement(at,{visible:this.state.sidewalkSelected,onClose:this._onCloseDrawer,selectedSidewalkDetails:this.state.selectedSidewalkDetails,onOpenImages:this._viewImages,updateRatings:this._updateRatings}),s.a.createElement(ut,{onClose:this._closeImages,visible:this.state.viewingImages}),s.a.createElement(Mt,null))}}]),t}(g.Component),Tt=function(e){function t(){return Object(r.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"renderCategory",value:function(e,t){return s.a.createElement("div",null,s.a.createElement("h3",null,e),s.a.createElement("p",null,t),s.a.createElement("hr",null))}},{key:"render",value:function(){return s.a.createElement("div",{className:"padding25"},this.renderCategory("What is this website about?","This website was made for the purpose of allowing the citizens of Edmonton to discuss \n\t\t\t\t\ttheir experiences on sidewalks across the city with other people. As a user of this site, you are able to select any\n\t\t\t\t\tsidewalk in the city from the map displayed on the home page. By selecting a sidewalk, you will be\n\t\t\t\t\tshown what other people think about that particular sidewalk, through ratings, images, and comments.\n\t\t\t\t\tYou can leave your own ratings and comments on the sidewalk, as well as upload any image that you\n\t\t\t\t\tfeel is relevant to the sidewalk."),this.renderCategory("Who will use the results?","\n\t\t\t\tThe results will primarily be used by two parties. The first one is government officials, so they can see\n\t\t\t\twhat sidewalks in the city are in need of improvement the most. STEPS researchers will also use the data collected\n\t\t\t\tfrom this website so that they can analyze it to get a bigger picture of the overall state of sidewalks\n\t\t\t\tin Edmonton.\n\t\t\t\t"),this.renderCategory("How can I get involved?","\n\t\t\t\tAll you need to do to be involved with the STEPS application is to leave your feelings and thoughts\n\t\t\t\tabout particular sidewalks. You can rate any sidewalk you want, comment on it, or even upload an image to it.\n\t\t\t\t"),this.renderCategory("Privacy Policy","\n\t\t\t\tAll of the data collected on this site will be used purely for research purposes. We will never sell any of the\n\t\t\t\tdata we collect to third parties, and nothing that you upload to the site will be directly linked back to you.\n\t\t\t\tAll of your interactions with the site will be anonymous.\n\t\t\t\t"))}}]),t}(s.a.Component),Ut=a(464),Bt=a.n(Ut),Ft=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e)))._dismissNotifications=function(){W.dismissImageApprovalNotification(),W.dismissImageRejectionNotification()},a.loadMoreImages=function(){a.setState({isNextPageLoading:!0}),W.getUnapprovedImages(a.state.pendingImages.length,a.state.pendingImages.length+10,function(){setTimeout(function(){a.setState({isNextPageLoading:!1})},500)})},a._onAcceptImage=function(e){W.handlePendingImages(!0,e.id)},a._onRejectImage=function(e){W.handlePendingImages(!1,e.id)},a._renderResponseButtons=function(e,t){return e&&a.state.isLoggedIn?s.a.createElement("div",null,s.a.createElement(V.a,{className:"closeButton",onClick:function(){a._onRejectImage(t)}}),s.a.createElement(It.a,{className:"acceptButton",onClick:function(){a._onAcceptImage(t)}})):null},a._onImageClicked=function(e){a.setState({currentImageIndex:e})},a._isRowLoaded=function(e){return Boolean(a.state.pendingImages[e])},a._rowRenderer=function(e){var t,n=e.index,i=e.key,o=e.style;return t=a._isRowLoaded(n)?s.a.createElement("div",{className:a.state.currentImageIndex===n?"infiniteImageRowSelected":"infiniteImageRowUnselected"},s.a.createElement(F.a,{className:"clickableItem"},a.props.renderAboveImage&&a.props.renderAboveImage(a.state.currentImageIndex===n,a.state.pendingImages[n]),s.a.createElement("img",{onClick:function(){a._onImageClicked(n)},className:"img-responsive fillAvailable",alt:"uploaded",src:a.state.pendingImages[n].url}))):s.a.createElement(J,null),s.a.createElement("div",{key:i,style:o},t)},a.store=Y,a.state={currentImageIndex:0},a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.state.isLoggedIn?W.getUnapprovedImages(0,5):this.props.history.push("/login")}},{key:"renderSelectedImage",value:function(){return this.state.pendingImages[this.state.currentImageIndex]?s.a.createElement("img",{className:"backgroundImage",alt:"selected",src:this.state.pendingImages[this.state.currentImageIndex].url}):s.a.createElement(J,null)}},{key:"render",value:function(){var e=this;return this.state.pendingImages?s.a.createElement("div",null,this.renderSelectedImage(),s.a.createElement(Bt.a,{hasMore:this.state.hasMoreImages,loadMore:this.state.isNextPageLoading?function(){}:this.loadMoreImages,sizes:[{columns:3,gutter:0},{mq:"1024px",columns:4,gutter:0}]},this.state.pendingImages.map(function(t,a){return e._rowRenderer({index:a,key:a,style:{height:"30vw",width:"30vw"}})})),this.state.isNextPageLoading&&s.a.createElement(J,null),s.a.createElement(kt,{onClose:this._dismissNotifications,visible:this.state.successfullyRespondedToImage,message:"Your response has been recorded."}),s.a.createElement(wt,{onClose:this._dismissNotifications,visible:this.state.failedToRespondToImage,message:"An error occurred while recording your response."})):s.a.createElement("h1",null,"No images uploaded")}}]),t}(p.a.Component),At=a(1142),Vt=a(465),zt=a.n(Vt),qt=a(466),Wt=a.n(qt),Yt=a(99),Gt=a.n(Yt),Ht={root:{flexGrow:1},menuButton:{marginLeft:-12,marginRight:20},button:{fontSize:14,"&:hover":{color:"#FFEB3B"},"&:focus":{color:"#FFEB3B"},color:"white"},titleButton:{fontSize:18,"&:hover":{color:"#FFEB3B"},"&:focus":{color:"#FFEB3B"},color:"white",fontFamily:"Proza Libre"}},Kt=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).store=Y,a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.classes;return s.a.createElement("div",{className:e.root},s.a.createElement(zt.a,{position:"static"},s.a.createElement(Wt.a,null,s.a.createElement(At.a,{to:"/"},s.a.createElement(Gt.a,{color:"inherit",className:e.titleButton},"STEPS ")," "),s.a.createElement(At.a,{to:"/about/"},s.a.createElement(Gt.a,{color:"inherit",className:e.button},"  About ")),s.a.createElement(At.a,{to:"/statistics/"},s.a.createElement(Gt.a,{color:"inherit",className:e.button}," ",s.a.createElement(At.a,{to:"/statistics/"})," Statistics ")),!this.state.isLoggedIn&&s.a.createElement(At.a,{to:"/login"},s.a.createElement(Gt.a,{color:"inherit",className:e.button}," Login ")," "),this.state.isLoggedIn&&s.a.createElement(At.a,{to:"/dashboard"},s.a.createElement(Gt.a,{color:"inherit",className:e.button},"  Dashboard")))))}}]),t}(p.a.Component),Jt=Object(Z.withStyles)(Ht)(Kt),Qt=a(467),Xt=a.n(Qt),$t=a(1143),Zt=a(184),ea=a.n(Zt),ta=function(e){function t(){var e;return Object(r.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this)))._handleUserChange=function(t){e.setState({enteredName:t.target.value})},e._handlePassChange=function(t){e.setState({enteredPassword:t.target.value})},e._validateCredentials=function(){return e.state.enteredName.length>0&&e.state.enteredPassword.length>0},e._handleSubmit=function(){W.checkCredentials(e.state.enteredName,Xt()(e.state.enteredPassword)),e.setState({enteredName:"",enteredPassword:""})},e._handleClose=function(){W.dismissLoginSuccess(),W.dismissLoginError()},e.store=Y,e.state={enteredName:"",enteredPassword:""},e}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentWillUpdate",value:function(){this.state.isLoggedIn&&this.props.history.push("/dashboard")}},{key:"render",value:function(){return s.a.createElement("div",{className:"loginContainer","data-admin-login":!0},s.a.createElement(F.a,null,s.a.createElement(ea.a,null,s.a.createElement("h3",{className:"adminTitleLogin"},"Admin Login"),s.a.createElement("form",null,s.a.createElement(x.a,{controlId:"username",bsSize:"small"},s.a.createElement($t.a,null,"Username"),s.a.createElement(P.a,{autoFocus:!0,type:"username",value:this.state.enteredName,onChange:this._handleUserChange,placeholder:"Username"})),s.a.createElement(x.a,{controlId:"password",bsSize:"small"},s.a.createElement($t.a,null,"Password"),s.a.createElement(P.a,{value:this.state.enteredPassword,onChange:this._handlePassChange,type:"password",placeholder:"Password"})),s.a.createElement(M.a,{bsStyle:"primary",type:"submit",onClick:this._handleSubmit,disabled:!this._validateCredentials()},"Login")))),s.a.createElement(kt,{onClose:this._handleClose,visible:this.state.successfullyLoggedIn,message:"You have successfully been logged in."}),s.a.createElement(wt,{onClose:this._handleClose,visible:this.state.failedToLogIn,message:"You have entered an incorrect username or password."}))}}]),t}(g.Component),aa=a(271),na=a.n(aa),sa=a(147),ia=a(468),oa=(a(1135),p.a.createActions(["loadSummaryStatistics"])),ra=function(e){function t(){var e;return Object(r.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this))).state={},e.listenables=oa,e}return Object(d.a)(t,e),Object(l.a)(t,[{key:"onLoadSummaryStatistics",value:function(){var e=this;this.setState({isLoading:!0}),O.sendGetRequest("sidewalk/summary").then(function(t){t.isLoading=!1,t.contributionsByMonth.sort(function(e,t){var a=e.monthYear.split("/"),n=parseInt(a[0]),s=parseInt(a[1]),i=t.monthYear.split("/"),o=parseInt(i[0]),r=parseInt(i[1]);return s===r?n-o:s-r}),e.setState(t)}).catch(function(t){e.setState({isLoading:!1}),console.error(t)})}}]),t}(p.a.Store),la=function(e){function t(){var e;return Object(r.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this)))._onChangeTab=function(t,a){e.setState({selectedTab:a})},e.store=ra,e.state={selectedTab:0},e}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){oa.loadSummaryStatistics()}},{key:"renderCard",value:function(e,t){return s.a.createElement(na.a,{item:!0,xs:!0},s.a.createElement(F.a,{className:"card"},s.a.createElement(ea.a,null,s.a.createElement("h3",{"data-contributions-value":t},t),e)))}},{key:"renderContributionsByDate",value:function(){var e=this.state.contributionsByMonth.map(function(e){return{month:parseInt(e.monthYear.split("/")[0]),year:parseInt(e.monthYear.split("/")[1]),amount:e.contributions}});return s.a.createElement(sa.BootstrapTable,{data:e,pagination:e.length>30,keyField:"a"},s.a.createElement(sa.TableHeaderColumn,{className:"lightFontWeight",dataField:"month",dataSort:!0,dataFormat:q.getMonthName},"Month"),s.a.createElement(sa.TableHeaderColumn,{className:"lightFontWeight",dataField:"year",dataSort:!0},"Year"),s.a.createElement(sa.TableHeaderColumn,{className:"lightFontWeight",dataField:"amount",dataSort:!0},"Contributions"))}},{key:"renderContributionsChart",value:function(){var e={labels:this.state.contributionsByMonth.map(function(e){var t=e.monthYear.split("/");return"".concat(q.getMonthName(parseInt(t[0]))," ").concat(t[1])}),datasets:[{label:"Contributions By Date",data:this.state.contributionsByMonth.map(function(e){return e.contributions}),backgroundColor:"purple"}]};return s.a.createElement(ia.a,{data:e,options:{legend:{display:!1},scales:{yAxes:[{gridLines:{display:!1}}]}}})}},{key:"renderSelectedTab",value:function(){return this.state.contributionsByMonth?s.a.createElement("div",{"data-summary-contributions":!0},s.a.createElement(na.a,{container:!0,spacing:16},this.renderCard("Total Ratings",this.state.totalRatings),this.renderCard("Total Comments",this.state.totalComments),this.renderCard("Total Images",this.state.totalImagesUploaded),this.renderCard("Contributions",this.state.totalImagesUploaded+this.state.totalRatings+this.state.totalComments)),s.a.createElement("div",{className:"table"},this.renderContributionsByDate()),this.renderContributionsChart()):s.a.createElement(J,null)}},{key:"render",value:function(){return s.a.createElement("div",{"data-summary-stats":!0,className:"statsPanel"},this.renderSelectedTab())}}]),t}(p.a.Component),ca=function(e){function t(){return Object(r.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return s.a.createElement("div",{className:"App"},s.a.createElement(Jt,null),s.a.createElement(m.a,null,s.a.createElement(h.a,{path:"/about/",component:Tt}),s.a.createElement(h.a,{path:"/statistics",component:la}),s.a.createElement(h.a,{path:"/login",component:ta}),s.a.createElement(h.a,{path:"/map/:id",component:Lt}),s.a.createElement(h.a,{path:"/dashboard",component:Ft}),s.a.createElement(h.a,{path:"/",component:Lt})))}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var ua=a(1146),da=a(471),ma=a.n(da),ha=Object(Z.createMuiTheme)({palette:{primary:ma.a,secondary:{main:"#FFEB3B"}},typography:{useNextVariants:!0}});o.a.render(s.a.createElement(ua.a,null,s.a.createElement(Z.MuiThemeProvider,{theme:ha},s.a.createElement(ca,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},472:function(e,t,a){e.exports=a(1140)},477:function(e,t,a){},479:function(e,t,a){},516:function(e,t){},518:function(e,t){},549:function(e,t){},550:function(e,t){},598:function(e,t){},600:function(e,t){},621:function(e,t){}},[[472,2,1]]]);
//# sourceMappingURL=main.39172fce.chunk.js.map